/*
jQuery.sheet() The Web Based Spreadsheet
$Id: jquery.sheet.min.js 413 2011-09-04 20:14:12Z RobertLeePlummerJr $
http://code.google.com/p/jquerysheet/
		
Copyright (C) 2010 Robert Plummer
Dual licensed under the LGPL v2 and GPL v2 licenses.
http://www.gnu.org/licenses/
*/
jQuery.fn.extend({sheet:function(a){jQuery(this).each(function(){var b=jQuery(this);var c=jQuery.extend({urlGet:"sheets/enduser.documentation.html",urlSave:"save.html",editable:true,editableTabs:true,barMenus:true,freezableCells:false,allowToggleState:true,urlMenu:"menu.html",menu:"",newColumnWidth:120,title:null,inlineMenu:null,buildSheet:false,calcOff:false,log:false,lockFormulas:false,parent:b,colMargin:18,fnSave:function(){b.getSheet().saveSheet()},fnOpen:function(){var d=prompt("Paste your table html here");if(d){b.getSheet().openSheet(d)}},fnClose:function(){},boxModelCorrection:2,calculations:{},cellSelectModel:"excel",autoAddCells:true,resizable:true,autoFiller:false,minSize:{rows:15,cols:5},forceColWidthsOnStartup:true,alertFormulaErrors:false},a);if(jQuery.sheet.instance){b.sheetInstance=jQuery.sheet.createInstance(c,jQuery.sheet.instance.length,b);jQuery.sheet.instance.push(b.sheetInstance)}else{b.sheetInstance=jQuery.sheet.createInstance(c,0,b);jQuery.sheet.instance=[b.sheetInstance]}b.attr("sheetInstance",jQuery.sheet.instance.length-1)});return this},disableSelectionSpecial:function(){this.each(function(){this.onselectstart=function(){return false};this.unselectable="on";jQuery(this).css("-moz-user-select","none")});return this},getSheet:function(){var a=parseInt(jQuery(this).attr("sheetInstance"));if(!isNaN(a)){return jQuery.sheet.instance[a]}return false},getCellValue:function(f,a,b){var c=$(this).getSheet();b=(b?b:0);try{return c.spreadsheets[b][f][a].value}catch(d){return""}}});jQuery.sheet={createInstance:function(d,c,b){var f={version:"2.0.x trunk",i:0,I:c,sheetCount:0,spreadsheets:[],obj:{autoFiller:function(){return jQuery("#"+f.id.autoFiller+f.i)},barCorner:function(){return jQuery("#"+f.id.barCorner+f.i)},barCornerAll:function(){return d.parent.find("div."+f.cl.barCorner)},barCornerParent:function(){return jQuery("#"+f.id.barCornerParent+f.i)},barCornerParentAll:function(){return d.parent.find("td."+f.cl.barCornerParent)},barHelper:function(){return jQuery("div."+f.cl.barHelper)},barLeft:function(){return jQuery("#"+f.id.barLeft+f.i)},barLeftAll:function(){return d.parent.find("div."+f.cl.barLeft)},barLeftParent:function(){return jQuery("#"+f.id.barLeftParent+f.i)},barLeftParentAll:function(){return d.parent.find("div."+f.cl.barLeftParent)},barLeftHandle:function(){return jQuery("#"+f.id.barLeftHandle)},barLeftMenu:function(){return jQuery("#"+f.id.barLeftMenu)},barTop:function(){return jQuery("#"+f.id.barTop+f.i)},barTopAll:function(){return d.parent.find("div."+f.cl.barTop)},barTopParent:function(){return jQuery("#"+f.id.barTopParent+f.i)},barTopParentAll:function(){return d.parent.find("div."+f.cl.barTopParent)},barTopHandle:function(){return jQuery("#"+f.id.barTopHandle)},barTopMenuParent:function(){return jQuery("#"+f.id.barTopMenuParent)},barTopMenu:function(){return jQuery("#"+f.id.barTopMenu)},cellActive:function(){return jQuery(f.cellLast.td)},cellMenu:function(){return jQuery("#"+f.id.cellMenu)},cellHighlighted:function(){return jQuery(f.highlightedLast.td)},chart:function(){return jQuery("div."+f.cl.chart)},controls:function(){return jQuery("#"+f.id.controls)},formula:function(){return jQuery("#"+f.id.formula)},fullScreen:function(){return jQuery("div."+f.cl.fullScreen)},inlineMenu:function(){return jQuery("#"+f.id.inlineMenu)},inPlaceEdit:function(){return jQuery("#"+f.id.inPlaceEdit)},label:function(){return jQuery("#"+f.id.label)},menu:function(){return jQuery("#"+f.id.menu)},pane:function(){return jQuery("#"+f.id.pane+f.i)},paneAll:function(){return d.parent.find("div."+f.cl.pane)},parent:function(){return d.parent},sheet:function(){return jQuery("#"+f.id.sheet+f.i)},sheetAll:function(){return d.parent.find("table."+f.cl.sheet)},tab:function(){return jQuery("#"+f.id.tab+f.i)},tabAll:function(){return this.tabContainer().find("a."+f.cl.tab)},tabContainer:function(){return jQuery("#"+f.id.tabContainer)},tableBody:function(){return document.getElementById(f.id.sheet+f.i)},tableControl:function(){return jQuery("#"+f.id.tableControl+f.i)},tableControlAll:function(){return d.parent.find("table."+f.cl.tableControl)},title:function(){return jQuery("#"+f.id.title)},ui:function(){return jQuery("#"+f.id.ui)},uiActive:function(){return d.parent.find("div."+f.cl.uiActive)}},id:{autoFiller:"jSheetAutoFiller_"+c+"_",barCorner:"jSheetBarCorner_"+c+"_",barCornerParent:"jSheetBarCornerParent_"+c+"_",barLeft:"jSheetBarLeft_"+c+"_",barLeftParent:"jSheetBarLeftParent_"+c+"_",barLeftHandle:"jSheetBarLeftHandle_"+c,barLeftMenu:"jSheetBarLeftMenu_"+c,barTop:"jSheetBarTop_"+c+"_",barTopParent:"jSheetBarTopParent_"+c+"_",barTopHandle:"jSheetBarTopHandle",barTopMenu:"jSheetBarTopMenu_"+c,barTopMenuParent:"jSheetBarTopMenuParent_"+c,cellMenu:"jSheetCellMenu_"+c,controls:"jSheetControls_"+c,formula:"jSheetControls_formula_"+c,inlineMenu:"jSheetInlineMenu_"+c,inPlaceEdit:"jSheetInPlaceEdit_"+c,label:"jSheetControls_loc_"+c,menu:"jSheetMenu_"+c,pane:"jSheetEditPane_"+c+"_",sheet:"jSheet_"+c+"_",tableControl:"tableControl_"+c+"_",tab:"jSheetTab_"+c+"_",tabContainer:"jSheetTabContainer_"+c,title:"jSheetTitle_"+c,ui:"jSheetUI_"+c},cl:{autoFiller:"jSheetAutoFiller",autoFillerHandle:"jSheetAutoFillerHandle",autoFillerConver:"jSheetAutoFillerCover",barCorner:"jSheetBarCorner",barCornerParent:"jSheetBarCornerParent",barHelper:"jSheetBarHelper",barLeftTd:"jSheetBarLeftTd",barLeft:"jSheetBarLeft",barLeftHandle:"jSheetBarLeftHandle",barLeftParent:"jSheetBarLeftParent",barTop:"jSheetBarTop",barTopHandle:"jSheetBarTopHandle",barTopParent:"jSheetBarTopParent",barTopTd:"jSheetBarTopTd",cellActive:"jSheetCellActive",cellHighlighted:"jSheetCellHighighted",chart:"jSheetChart",controls:"jSheetControls",error:"jSheetError",formula:"jSheetControls_formula",formulaParent:"jSheetControls_formulaParent",inlineMenu:"jSheetInlineMenu",fullScreen:"jSheetFullScreen",inPlaceEdit:"jSheetInPlaceEdit",menu:"jSheetMenu",parent:"jSheetParent",sheet:"jSheet",sheetPaneTd:"sheetPane",label:"jSheetControls_loc",pane:"jSheetEditPane",tab:"jSheetTab",tabContainer:"jSheetTabContainer",tabContainerFullScreen:"jSheetFullScreenTabContainer",tableControl:"tableControl",title:"jSheetTitle",toggle:"cellStyleToggle",ui:"jSheetUI",uiAutoFiller:"ui-state-active",uiActive:"ui-state-active",uiBar:"ui-widget-header",uiBarHighlight:"ui-state-highlight",uiBarLeftHandle:"ui-state-default",uiBarLeftMenu:"ui-state-default ui-corner-top",uiBarTopHandle:"ui-state-default",uiBarTopMenu:"ui-state-default ui-corner-top",uiCellActive:"ui-state-active",uiCellHighlighted:"ui-state-highlight",uiControl:"ui-widget-header ui-corner-top",uiControlTextBox:"ui-widget-content",uiError:"ui-state-error",uiFullScreen:"ui-widget-content ui-corner-all",uiInPlaceEdit:"ui-state-active",uiMenu:"ui-state-default",uiMenuUl:"ui-widget-header",uiMenuLi:"ui-widget-header",uiMenuHighlighted:"ui-state-highlight",uiPane:"ui-widget-content",uiParent:"ui-widget-content ui-corner-all",uiSheet:"ui-widget-content",uiTab:"ui-widget-header",uiTabActive:"ui-state-highlight"},msg:{addRowMulti:"How many rows would you like to add?",addColumnMulti:"How many columns would you like to add?",newSheet:"What size would you like to make your spreadsheet? Example: '5x10' creates a sheet that is 5 columns by 10 rows.",openSheet:"Are you sure you want to open a different sheet?  All unsaved changes will be lost.",cellFind:"No results found.",toggleHideRow:"No row selected.",toggleHideColumn:"Now column selected.",merge:"Merging is not allowed on the first row.",evalError:"Error, functions as formulas not supported.",menuInsertColumnAfter:"Insert column after",menuInsertColumnBefore:"Insert column before",menuAddColumnEnd:"Add column to end",menuDeleteColumn:"Delete this column",menuInsertRowAfter:"Insert row after",menuInsertRowBefore:"Insert row before",menuAddRowEnd:"Add row to end",menuDeleteRow:"Delete this row",menuAddSheet:"Add spreadsheet",menuDeleteSheet:"Delete spreadsheet"},kill:function(){f.obj.tabContainer().remove();f.obj.fullScreen().remove();f.obj.inPlaceEdit().remove();b.removeClass(f.cl.uiParent).html("").removeAttr("sheetInstance");cE=d=jQuery.sheet.instance[c]=f=null;delete cE;delete d;delete jQuery.sheet.instance[c];delete f},trigger:function(i,j){j=(j?j:[]);b.trigger(i,[f].concat(j))},spreadsheetsToArray:function(i){if(i||f.spreadsheets.length==0){f.cycleCellsAll(function(k,l,j){var m=jQuery(this);f.createCell(k,l,j,m.text(),m.attr("formula"))})}return f.spreadsheets},spreadsheetToArray:function(k,j){j=(j?j:f.i);if(k||!f.spreadsheets[j]){f.cycleCells(function(l,m,i){var n=jQuery(this);f.createCell(l,m,i,n.text(),n.attr("formula"))})}},createCell:function(k,n,j,m,o,l,i){if(!f.spreadsheets[k]){f.spreadsheets[k]=[]}if(!f.spreadsheets[k][n]){f.spreadsheets[k][n]=[]}f.spreadsheets[k][n][j]={formula:o,value:m,calcCount:(l?l:0),calcLast:(i?i:-1)};return f.spreadsheets[k][n][j]},nav:false,setNav:function(i){jQuery(jQuery.sheet.instance).each(function(){this.nav=false});f.nav=i},controlFactory:{addRowMulti:function(k,i,j){if(!k){k=prompt(f.msg.addRowMulti)}if(k){if(!isNaN(k)){f.controlFactory.addCells(null,i,null,parseInt(k),"row",j)}}},addColumnMulti:function(k,i,j){if(!k){k=prompt(f.msg.addColumnMulti)}if(k){if(!isNaN(k)){f.controlFactory.addCells(null,i,null,parseInt(k),"col",j)}}},addCells:function(B,D,y,s,n,p){if(d.autoFiller){f.obj.autoFiller().hide()}f.setDirty(true);f.obj.barHelper().remove();var q=f.obj.sheet();var w=q.width();s=(s?s:1);n=(n?n:"col");var k=(n=="row"?f.cellLast.row:f.cellLast.col);if(!B){if(k==-1){B=":last"}else{B=":eq("+k+")"}}else{if(!isNaN(B)){B=":eq("+(B)+")"}}var x;switch(n){case"row":x={bar:f.obj.barLeft().children("div"+B),barParent:f.obj.barLeft(),cells:function(){return q.find("tr"+B)},col:function(){return""},newBar:'<div class="'+f.cl.uiBar+'" style="height: '+(d.colMargin-d.boxModelCorrection)+'px;" />',size:function(){return f.getTdLocation(x.cells().find("td:last"))},loc:function(){return f.getTdLocation(x.cells().find("td:first"))},newCells:function(){var o=x.size().col;var F="";for(var E=0;E<=o;E++){F+="<td />"}return'<tr style="height: '+d.colMargin+'px;">'+F+"</tr>"},newCol:"",reLabel:function(){x.barParent.children().each(function(o){jQuery(this).text(o+1)})},dimensions:function(E,i,o){E.height(i.height(d.colMargin).outerHeight()-d.boxModelCorrection)},offset:{row:s,col:0}};break;case"col":x={bar:f.obj.barTop().children("div"+B),barParent:f.obj.barTop(),cells:function(){var J=q.find("tr:first").children(B);var I=q.find("td:last");var H=f.getTdLocation(J);var G=f.getTdLocation(I);var E=jQuery(f.getTd(f.i,H.row,H.col));var o;for(var F=1;F<=G.row;F++){E.push(f.getTd(f.i,F,H.col))}return E},col:function(){return q.find("col"+B)},newBar:'<div class="'+f.cl.uiBar+'"/>',newCol:"<col />",loc:function(i){i=(i?i:x.cells());return f.getTdLocation(i.first())},newCells:function(){return"<td />"},reLabel:function(){x.barParent.children().each(function(o){jQuery(this).text(jSE.columnLabelString(o))})},dimensions:function(F,i,E){var o=d.newColumnWidth;E.width(o).css("width",o+"px").attr("width",o+"px");F.width(o-d.boxModelCorrection);q.width(w+(o*s))},offset:{row:0,col:s}};break}f.cellUndoable.add(jQuery(q).add(x.barParent));var m=x.cells();var t=x.loc(m);var r=x.col();var v=x.newBar;var u=x.newCells();var l=x.newCol;var A="";var j="";var C="";for(var z=0;z<s;z++){A+=l;j+=v;C+=u}A=jQuery(A);j=jQuery(j);C=jQuery(C);if(D){m.before(C);x.bar.before(j);jQuery(r).before(A)}else{m.after(C);x.bar.after(j);jQuery(r).after(A)}f.setTdIds(q,f.i);x.dimensions(j,C,A);x.reLabel();f.obj.pane().scroll();if(!p&&B!=":last"){f.offsetFormulas(t,x.offset,D)}f.sheetSyncSize();f.cellUndoable.add(jQuery(q).add(x.barParent))},addRow:function(k,j,i){f.controlFactory.addCells(k,j,i,1,"row");f.trigger("addRow",[k,j,i,1])},addColumn:function(k,j,i){f.controlFactory.addCells(k,j,i,1,"col");f.trigger("addColumn",[atRow,j,atRowQ,1])},barLeft:function(k,l){f.obj.barLeft().remove();var i=jQuery('<div border="1px" id="'+f.id.barLeft+f.i+'" class="'+f.cl.barLeft+'" />');var j;if(k){j=function(m,n,o){o.height(parseInt(n.outerHeight())-d.boxModelCorrection)}}else{j=function(m,n,o){o.height(parseInt(n.css("height").replace("px",""))-d.boxModelCorrection)}}l.find("tr").each(function(m){var n=jQuery("<div>"+(m+1)+"</div>");i.append(n);j(m,jQuery(this),n)});f.evt.barMouseDown.height(f.obj.barLeftParent().append(i))},barTop:function(i,l){f.obj.barTop().remove();var k=jQuery('<div id="'+f.id.barTop+f.i+'" class="'+f.cl.barTop+'" />');k.height(d.colMargin);var j;var m;if(i){j=l.find("tr:first").children();m=function(n){return f.attrH.width(n)}}else{j=l.find("col");m=function(n){return parseInt(jQuery(n).css("width").replace("px",""))-d.boxModelCorrection}}j.each(function(p){var o=jSE.columnLabelString(p);var n=m(this);var q=jQuery("<div>"+o+"</div>").width(n).height(d.colMargin);k.append(q)});f.evt.barMouseDown.width(f.obj.barTopParent().append(k))},barTopHandle:function(k,j){if(f.busy){return false}if(j!=0){return false}f.obj.barHelper().remove();var m=f.obj.barTop().children().eq(j);var n=m.position();var l=jQuery('<div id="'+f.id.barTopHandle+'" class="'+f.cl.uiBarTopHandle+" "+f.cl.barHelper+" "+f.cl.barTopHandle+'" />').height(d.colMargin-2).css("left",n.left+"px").appendTo(k);f.draggable(l,{axis:"x",start:function(){f.busy=true},stop:function(){f.busy=false}})},barLeftHandle:function(k,j){if(f.busy){return false}if(j!=0){return false}f.obj.barHelper().remove();var l=f.obj.barLeft().children().eq(j);var n=l.position();var m=jQuery('<div id="'+f.id.barLeftHandle+'" class="'+f.cl.uiBarLeftHandle+" "+f.cl.barHelper+" "+f.cl.barLeftHandle+'" />').width(d.colMargin-6).height(d.colMargin/3).css("top",n.top+"px").appendTo(k);f.draggable(m,{axis:"y",start:function(){f.busy=true},stop:function(){f.busy=false}})},makeMenu:function(j,i){var l;function k(n,m){switch(n){case"line":jQuery("<hr />").appendTo(l);break;default:jQuery("<div>"+n+"</div>").click(function(){m();return false}).appendTo(l)}}switch(j){case"top":l=jQuery('<div id="'+f.id.barTopMenu+'" class="'+f.cl.uiMenu+" "+f.cl.barHelper+'" />');break;case"left":l=jQuery('<div id="'+f.id.barLeftMenu+'" class="'+f.cl.uiMenu+" "+f.cl.barHelper+'" />');break;case"cell":l=jQuery('<div id="'+f.id.cellMenu+'" class="'+f.cl.uiMenu+" "+f.cl.barHelper+'" />');break}l.width(d.newColumnWidth).mouseleave(function(){l.hide()}).appendTo("body").hide();jQuery(i).each(function(){k(this.msg,this.fn)});return l},barTopMenu:function(m,k,l){if(f.busy){return false}var n=f.obj.barTopMenu().hide();if(k){f.obj.barTopHandle().remove()}var n;if(!n.length){n=f.controlFactory.makeMenu("top",[{msg:f.msg.menuInsertColumnAfter,fn:function(){f.controlFactory.addColumn();return false}},{msg:f.msg.menuInsertColumnBefore,fn:function(){f.controlFactory.addColumn(null,true);return false}},{msg:f.msg.menuAddColumnEnd,fn:function(){f.controlFactory.addColumn(":last");return false}},{msg:f.msg.menuDeleteColumn,fn:function(){f.deleteColumn();return false}}])}if(!l){n.css("left",(m.pageX-5)+"px").css("top",(m.pageY-5)+"px").show();return n}var j=f.obj.barTopMenuParent().hide();if(!j.length){j=jQuery('<div id="'+f.id.barTopMenuParent+'" class="'+f.cl.uiBarTopMenu+" "+f.cl.barHelper+'"><span class="ui-icon ui-icon-triangle-1-s" /></span></div>').click(function(i){j.parent().mousedown().mouseup();var o=j.offset();n.css("left",(o.left-(d.newColumnWidth-d.colMargin))+"px").css("top",(o.top+(d.colMargin*0.8))+"px").show()}).blur(function(){if(n){n.hide()}}).height(d.colMargin)}j.appendTo(l).show()},barLeftMenu:function(k,j){if(f.busy){return false}f.obj.barLeftMenu().hide();if(j){f.obj.barLeftHandle().remove()}var l;l=f.obj.barLeftMenu();if(!l.length){l=f.controlFactory.makeMenu("left",[{msg:f.msg.menuInsertRowAfter,fn:function(){f.controlFactory.addRow();return false}},{msg:f.msg.menuInsertRowBefore,fn:function(){f.controlFactory.addRow(null,true);return false}},{msg:f.msg.menuAddRowEnd,fn:function(){f.controlFactory.addRow(":last");return false}},{msg:f.msg.menuDeleteRow,fn:function(){f.deleteRow();return false}}])}l.css("left",(k.pageX-5)+"px").css("top",(k.pageY-5)+"px").show()},cellMenu:function(i){if(f.busy){return false}f.obj.cellMenu().hide();var j=f.obj.cellMenu();if(!j.length){j=f.controlFactory.makeMenu("cell",[{msg:f.msg.menuInsertColumnAfter,fn:function(){f.controlFactory.addColumn();return false}},{msg:f.msg.menuInsertColumnBefore,fn:function(){f.controlFactory.addColumn(null,true);return false}},{msg:f.msg.menuAddColumnEnd,fn:function(){f.controlFactory.addColumn(":last");return false}},{msg:f.msg.menuDeleteColumn,fn:function(){f.deleteColumn();return false}},{msg:"line"},{msg:f.msg.menuInsertRowAfter,fn:function(){f.controlFactory.addRow();return false}},{msg:f.msg.menuInsertRowBefore,fn:function(){f.controlFactory.addRow(null,true);return false}},{msg:f.msg.menuAddRowEnd,fn:function(){f.controlFactory.addRow(":last");return false}},{msg:f.msg.menuDeleteRow,fn:function(){f.deleteRow();return false}},{msg:"line"},{msg:f.msg.menuAddSheet,fn:function(){f.addSheet("5x10")}},{msg:f.msg.menuDeleteSheet,fn:function(){f.deleteSheet()}}])}j.css("left",(i.pageX-5)+"px").css("top",(i.pageY-5)+"px").show()},header:function(){f.obj.controls().remove();f.obj.tabContainer().remove();var l=jQuery('<div id="'+f.id.controls+'" class="'+f.cl.controls+'"></div>');var i=jQuery('<table cellpadding="0" cellspacing="0" border="0"><tr /></table>').prependTo(l);var j=jQuery("<tr />");if(d.title){var o;if(jQuery.isFunction(d.title)){o=f.title(f)}else{o=d.title}j.append(jQuery('<td id="'+f.id.title+'" class="'+f.cl.title+'" />').html(o))}if(d.inlineMenu&&f.isSheetEditable()){var p;if(jQuery.isFunction(d.inlineMenu)){p=d.inlineMenu(f)}else{p=d.inlineMenu}j.append(jQuery('<td id="'+f.id.inlineMenu+'" class="'+f.cl.inlineMenu+'" />').html(p))}if(f.isSheetEditable()){function m(s){var t=jQuery('<td id="'+f.id.menu+'" class="'+f.cl.menu+'" />').html(s.replace(/sheetInstance/g,"jQuery.sheet.instance["+c+"]").replace(/menuInstance/g,c));t.prependTo(j).find("ul").hide().addClass(f.cl.uiMenuUl).first().show();t.find("li").addClass(f.cl.uiMenuLi).hover(function(){jQuery(this).find("ul:first").hide().show()},function(){jQuery(this).find("ul:first").hide()});return t}if(d.menu){m(d.menu)}else{jQuery("<div />").load(d.urlMenu,function(){m(jQuery(this).html())})}var n=jQuery('<table cellpadding="0" cellspacing="0" border="0"><tr><td id="'+f.id.label+'" class="'+f.cl.label+'"></td><td class="'+f.cl.formulaParent+'"><textarea id="'+f.id.formula+'" class="'+f.cl.formula+'"></textarea></td></tr></table>').appendTo(l).find("textarea").keydown(f.evt.keyDownHandler.formulaKeydown).keyup(function(){f.obj.inPlaceEdit().val(f.obj.formula().val())}).change(function(){f.obj.inPlaceEdit().val(f.obj.formula().val())}).bind("paste",f.evt.pasteOverCells).focus(function(){f.setNav(false)}).focusout(function(){f.setNav(true)}).blur(function(){f.setNav(true)});jQuery(jQuery.sheet.instance).each(function(){this.nav=false});f.setNav(true);jQuery(document).keydown(f.evt.keyDownHandler.documentKeydown)}j.appendTo(i);var q=jQuery('<div id="'+f.id.tabContainer+'" class="'+f.cl.tabContainer+'" />').mousedown(function(s){f.trigger("switchSpreadsheet",[jQuery(s.target).attr("i")*1]);return false}).dblclick(function(s){f.trigger("renameSpreadsheet",[jQuery(s.target).attr("i")*1]);return});if(f.isSheetEditable()){var r=jQuery('<span class="'+f.cl.uiTab+' ui-corner-bottom" title="Add a spreadsheet" i="-1">+</span>').appendTo(q);if(jQuery.fn.sortable){var k;q.sortable({placeholder:"ui-state-highlight",axis:"x",forceHelperSize:true,forcePlaceholderSize:true,opacity:0.6,cancel:'span[i="-1"]',start:function(t,s){k=s.item.index();f.trigger("tabSortstart",[t,s])},update:function(t,s){f.trigger("tabSortupdate",[t,s,k])}})}}else{jQuery("<span />").appendTo(q)}d.parent.html("").append(l).append('<div id="'+f.id.ui+'" class="'+f.cl.ui+'">').after(q)},sheetUI:function(n,k,l,m){if(!k){f.sheetCount=0;f.i=0}else{f.sheetCount=parseInt(k);f.i=f.sheetCount;k=f.i}n=f.tuneTableForSheetUse(n);f.readOnly[k]=n.hasClass("readonly");var j=f.controlFactory.table().appendTo(f.obj.ui());var q=f.obj.pane().html(n);if(d.autoFiller&&f.isSheetEditable()){q.append(f.controlFactory.autoFiller())}f.sheetDecorate(n);f.controlFactory.barTop(m,n);f.controlFactory.barLeft(m,n);f.sheetTab(true);if(f.isSheetEditable()){var p=f.obj.formula();q.mousedown(function(i){if(f.isTd(i.target)){f.evt.cellOnMouseDown(i);return false}}).bind("contextmenu",function(i){f.controlFactory.cellMenu(i);return false}).disableSelectionSpecial().dblclick(f.evt.cellOnDblClick)}f.themeRoller.start(k);f.setTdIds(n,f.i);f.checkMinSize(n);f.evt.scrollBars(q);f.addTab();if(l){l(j,q)}return j},table:function(){return jQuery('<table cellpadding="0" cellspacing="0" border="0" id="'+f.id.tableControl+f.i+'" class="'+f.cl.tableControl+'"><tbody><tr><td id="'+f.id.barCornerParent+f.i+'" class="'+f.cl.barCornerParent+'"><div style="height: '+d.colMargin+"; width: "+d.colMargin+';" id="'+f.id.barCorner+f.i+'" class="'+f.cl.barCorner+'"'+(f.isSheetEditable()?' onClick="jQuery.sheet.instance['+c+"].cellSetActiveBar('all');\"":"")+' title="Select All">&nbsp;</div></td><td class="'+f.cl.barTopTd+'"><div id="'+f.id.barTopParent+f.i+'" class="'+f.cl.barTopParent+'"></div></td></tr><tr><td class="'+f.cl.barLeftTd+'"><div style="width: '+d.colMargin+';" id="'+f.id.barLeftParent+f.i+'" class="'+f.cl.barLeftParent+'"></div></td><td class="'+f.cl.sheetPaneTd+'"><div id="'+f.id.pane+f.i+'" class="'+f.cl.pane+'"></div></td></tr></tbody></table>')},chartCache:[],safeImg:function(j,i){return jQuery("<img />").hide().load(function(){jQuery(this).fadeIn(function(){jQuery(this).addClass("safeImg");f.attrH.setHeight(parseInt(i),"cell",false)})}).attr("src",j)},inPlaceEdit:function(o){f.obj.inPlaceEdit().remove();var n=f.obj.formula();var m=o.offset();var l=o.attr("style");var j=o.width();var k=o.height();var i=jQuery('<textarea id="'+f.id.inPlaceEdit+'" class="'+f.cl.inPlaceEdit+" "+f.cl.uiInPlaceEdit+'" />').css("left",m.left).css("top",m.top).width(j).height(k).keydown(f.evt.inPlaceEditOnKeyDown).keyup(function(){n.val(i.val())}).change(function(){n.val(i.val())}).focus(function(){f.setNav(false)}).focusout(function(){f.setNav(true)}).blur(function(){f.setNav(true)}).bind("paste",f.evt.pasteOverCells).appendTo("body").val(n.val()).focus().select();if(jQuery.fn.elastic){i.elastic()}},autoFiller:function(){return jQuery('<div id="'+(f.id.autoFiller+f.i)+'" class="'+f.cl.autoFiller+" "+f.cl.uiAutoFiller+'"><div class="'+f.cl.autoFillerHandle+'" /><div class="'+f.cl.autoFillerCover+'" /></div>').mousedown(function(i){var k=f.cellLast.td;if(k){var j=f.getTdLocation(k);f.cellSetActive(k,j,true,f.autoFillerNotGroup,function(){var m=f.obj.cellHighlighted();var l=f.getTdLocation(m.first());f.fillUpOrDown(l.row<j.row||l.col<j.col);f.autoFillerGoToTd(m.last());f.autoFillerNotGroup=false})}})}},autoFillerNotGroup:true,sizeSync:{},updateCellsAfterPasteToFormula:function(v){var u=0;var s=f.obj.formula();v=(v?v:s.val());var r={row:f.cellLast.row,col:f.cellLast.col};var l=s.val();var n=l;if(r.row==-1&&r.col==-1){return false}var p=jQuery("<div />");var t=jQuery("<div />");var x=l.split(/\n/g);for(var q=0;q<x.length;q++){var k=x[q].split(/\t/g);for(var o=0;o<k.length;o++){u++;var m=jQuery(f.getTd(f.i,q+r.row,o+r.col));if(m.length){var w=f.spreadsheets[f.i][q+r.row][o+r.col];p.append(m.clone());if((k[o]+"").charAt(0)=="="){w.formula=k[o];m.attr("formula",k[o])}else{w.formula=null;w.value=k[o];m.html(k[o]).removeAttr("formula")}t.append(m.clone());if(q==0&&o==0){n=k[o]}}}}if(l!=n){s.val(n)}f.cellUndoable.add(p.children());f.fillUpOrDown(false,false,n);f.cellUndoable.add(t.children());f.setDirty(true);f.evt.cellEditDone(true)},evt:{keyDownHandler:{enterOnInPlaceEdit:function(i){if(!i.shiftKey){return f.evt.cellSetFocusFromKeyCode(i)}else{return true}},enter:function(i){if(!f.cellLast.isEdit&&!i.ctrlKey){f.cellLast.td.dblclick();return false}else{return this.enterOnInPlaceEdit(i)}},tab:function(i){return f.evt.cellSetFocusFromKeyCode(i)},findCell:function(i){if(i.ctrlKey){f.cellFind();return false}return true},redo:function(i){if(i.ctrlKey&&!f.cellLast.isEdit){f.cellUndoable.undoOrRedo();return false}return true},undo:function(i){if(i.ctrlKey&&!f.cellLast.isEdit){f.cellUndoable.undoOrRedo(true);return false}return true},pageUpDown:function(i){var l=f.obj.pane();var k=f.cellLast.td.position().left;var j=0;if(i){j=0;l.scrollTop(l.scrollTop()-l.height())}else{j=l.height()-(d.colMargin*3);l.scrollTop(l.scrollTop()+j)}return f.evt.cellSetFocusFromXY(k,j)},formulaKeydown:function(i){switch(i.keyCode){case key.ESCAPE:f.evt.cellEditAbandon();break;case key.ENTER:f.evt.cellSetFocusFromKeyCode(i);return false;break;default:f.cellLast.isEdit=true}},documentKeydown:function(i){if(f.nav){switch(i.keyCode){case key.TAB:f.evt.keyDownHandler.tab(i);break;case key.ENTER:case key.LEFT:case key.UP:case key.RIGHT:case key.DOWN:(i.shiftKey?f.evt.cellSetHighlightFromKeyCode(i):f.evt.cellSetFocusFromKeyCode(i));break;case key.PAGE_UP:f.evt.keyDownHandler.pageUpDown(true);break;case key.PAGE_DOWN:f.evt.keyDownHandler.pageUpDown();break;case key.HOME:case key.END:f.evt.cellSetFocusFromKeyCode(i);break;case key.V:f.evt.pasteOverCells(i);break;case key.Y:f.evt.keyDownHandler.redo(i);break;case key.Z:f.evt.keyDownHandler.undo(i);break;case key.ESCAPE:f.evt.cellEditAbandon();break;case key.F:f.evt.keyDownHandler.findCell(i);break;case key.CONTROL:case key.CAPS_LOCK:case key.SHIFT:case key.ALT:break;default:f.obj.cellActive().dblclick();return true}return false}}},pasteOverCells:function(k){if(k.ctrlKey||k.type=="paste"){var j=function(){f.updateCellsAfterPasteToFormula()};var i=jQuery(document).one("keyup",function(){j();j=function(){};i.mouseup()}).one("mouseup",function(){j();j=function(){};i.keyup()});return true}},inPlaceEditOnKeyDown:function(i){switch(i.keyCode){case key.ENTER:return f.evt.keyDownHandler.enterOnInPlaceEdit(i);break;case key.TAB:return f.evt.keyDownHandler.tab(i);break;case key.ESCAPE:f.evt.cellEditAbandon();return false;break}},formulaChange:function(i){f.obj.inPlaceEdit().val(f.obj.formula().val())},inPlaceEditChange:function(i){f.obj.formula().val(f.obj.inPlaceEdit().val())},cellEditDone:function(k){switch(f.cellLast.isEdit||k){case true:f.obj.inPlaceEdit().remove();var n=f.obj.formula();var m=f.cellLast.td;switch(f.isFormulaEditable(m)){case true:if(m&&f.cellLast.row>-1&&f.cellLast.col>-1){f.cellUndoable.add(m);var j=n.val();var l=m.text();var i=f.spreadsheets[f.i][f.cellLast.row][f.cellLast.col];if(j.charAt(0)=="="){m.attr("formula",j).html("");i.value=j;i.formula=j}else{m.removeAttr("formula").html(j);i.value=j;i.formula=null}i.calcCount=0;if(j!=l||k){f.calc()}f.attrH.setHeight(f.cellLast.row,"cell");f.cellUndoable.add(m);f.cellLast.isEdit=false;f.setDirty(true);f.trigger("afterCellEdit",[{td:f.cellLast.td,row:f.cellLast.row,col:f.cellLast.col,spreadsheetIndex:f.i,sheetIndex:c}])}}break;default:f.attrH.setHeight(f.cellLast.row,"cell",false)}},cellEditAbandon:function(i){f.obj.inPlaceEdit().remove();f.themeRoller.cell.clearActive();f.themeRoller.bar.clearActive();f.themeRoller.cell.clearHighlighted();if(!i){f.calc()}f.cellLast.td=jQuery("<td />");f.cellLast.row=-1;f.cellLast.col=-1;f.rowLast=-1;f.colLast=-1;f.labelUpdate("",true);f.obj.formula().val("");if(d.autoFiller){f.obj.autoFiller().hide()}return false},cellSetFocusFromXY:function(j,i,k){var l=f.getTdFromXY(j,i,k);if(f.isTd(l)){f.themeRoller.cell.clearHighlighted();f.cellEdit(l);return false}else{return true}},cellSetHighlightFromKeyCode:function(l){var m=f.highlightedLast.colLast;var k=f.highlightedLast.rowLast;var i=f.sheetSize();jQuery(f.cellLast.td).mousedown();switch(l.keyCode){case key.UP:k--;break;case key.DOWN:k++;break;case key.LEFT:m--;break;case key.RIGHT:m++;break}function j(o,n){if(o<0){return 0}if(o>n){return n}return o}k=j(k,i.height);m=j(m,i.width);td=f.getTd(f.i,k,m);jQuery(td).mousemove().mouseup();f.highlightedLast.rowLast=k;f.highlightedLast.colLast=m;return false},cellSetFocusFromKeyCode:function(m){var p=f.cellLast.col;var j=f.cellLast.row;var l=false;switch(m.keyCode){case key.UP:j--;break;case key.DOWN:j++;break;case key.LEFT:p--;break;case key.RIGHT:p++;break;case key.ENTER:j++;l=true;if(f.highlightedLast.td.length>1){var k=f.obj.inPlaceEdit();var i=k.val();k.remove();f.updateCellsAfterPasteToFormula(i);return true}else{if(d.autoAddCells){if(f.cellLast.row==f.sheetSize().height){f.controlFactory.addRow(":last")}}}break;case key.TAB:l=true;if(m.shiftKey){p--}else{p++}if(d.autoAddCells){if(f.cellLast.col==f.sheetSize().width){f.controlFactory.addColumn(":last")}}break;case key.HOME:p=0;break;case key.END:p=f.cellLast.td.parent().find("td").length-1;break}p=(p<0?0:p);j=(j<0?0:j);if(!f.cellLast.isEdit||l){var o=f.getTd(f.i,j,p);if(o){f.themeRoller.cell.clearHighlighted();o=jQuery(o);if(o.is(":hidden")){function n(r,q){if(q){p++;r=r.next()}else{p--;r=r.prev()}if(r.is(":hidden")&&r.length){return n(r,q)}return r}o=n(o,p>f.cellLast.col)}f.cellEdit(o);return false}}return true},cellOnMouseDown:function(i){f.obj.formula().blur();if(i.shiftKey){f.getTdRange(i,f.obj.formula().val())}else{f.cellEdit(jQuery(i.target),true)}},cellOnDblClick:function(i){f.cellLast.isEdit=f.isSheetEdit=true;f.controlFactory.inPlaceEdit(f.cellLast.td)},scrollBars:function(j){var i={barLeft:f.obj.barLeftParent(),barTop:f.obj.barTopParent()};j.scroll(function(){i.barTop.scrollLeft(j.scrollLeft());i.barLeft.scrollTop(j.scrollTop());f.trigger("paneScroll")})},barMouseDown:{select:function(j,i,k){k(i.target);j.unbind("mouseover").mouseover(function(l){k(l.target)});jQuery(document).one("mouseup",function(){j.unbind("mouseover").unbind("mouseup")});return false},first:0,last:0,height:function(j){var i=function(){};j.unbind("mousedown").mousedown(function(l){var k=f.getBarLeftIndex(l.target);if(k==-1){return false}f.evt.barMouseDown.first=f.evt.barMouseDown.last=f.rowLast=k;f.evt.barMouseDown.select(j,l,i);return false}).bind("contextmenu",function(l){if(!f.isSheetEditable()){return false}var k=f.getBarLeftIndex(l.target);if(k==-1){return false}j.parent().mousedown().mouseup();f.controlFactory.barLeftMenu(l,k);return false}).parent().mouseover(function(l){if(jQuery(l.target).attr("id")){return false}var k=f.getBarLeftIndex(l.target);if(k==-1){return false}f.resizeBarLeft(l);if(f.isSheetEditable()){f.controlFactory.barLeftHandle(j,k)}});if(f.isSheetEditable()){i=function(l){if(!l){return false}if(jQuery(l).attr("id")){return false}var k=f.getBarLeftIndex(l);if(k==-1){return false}f.rowLast=k;f.evt.barMouseDown.last=k;f.cellSetActiveBar("row",f.evt.barMouseDown.first,f.evt.barMouseDown.last)}}},width:function(k){var i=function(){};var j=0;k.unbind("mousedown").mousedown(function(m){var l=f.getBarTopIndex(m.target);if(l==-1){return false}f.evt.barMouseDown.first=f.evt.barMouseDown.last=f.colLast=l;f.evt.barMouseDown.select(k,m,i);return false}).bind("contextmenu",function(m){if(!f.isSheetEditable()){return false}var l=f.getBarTopIndex(m.target);if(l==-1){return false}k.parent().mousedown().mouseup();f.controlFactory.barTopMenu(m,l);return false}).parent().mouseover(function(m){if(jQuery(m.target).attr("id")){return false}var l=f.getBarTopIndex(m.target);if(l==-1){return false}f.resizeBarTop(m);if(f.isSheetEditable()){f.controlFactory.barTopHandle(k,l);f.controlFactory.barTopMenu(m,l,jQuery(m.target))}return false});if(f.isSheetEditable()){i=function(m){if(!m){return false}if(jQuery(m).attr("id")){return false}var l=f.getBarTopIndex(m);if(l==-1){return false}f.colLast=l;f.evt.barMouseDown.last=l;f.cellSetActiveBar("col",f.evt.barMouseDown.first,f.evt.barMouseDown.last)}}}}},isTd:function(i){i=(i[0]?i[0]:[i]);if(i[0]){if(!isNaN(i[0].cellIndex)){return true}}return false},readOnly:[],isSheetEditable:function(j){j=(j==null?f.i:j);return(d.editable==true&&!f.readOnly[j])},isFormulaEditable:function(i){if(d.lockFormulas){if(i.attr("formula")!==undefined){return false}}return true},toggleFullScreen:function(){if(f.obj.fullScreen().is(":visible")){jQuery("body").removeClass("bodyNoScroll");d.parent=b;var i=d.parent.width();var j=d.parent.height();d.width=i;d.height=j;f.obj.tabContainer().insertAfter(d.parent.append(f.obj.fullScreen().children())).removeClass(f.cl.tabContainerFullScreen);f.obj.fullScreen().remove();f.sheetSyncSize()}else{jQuery("body").addClass("bodyNoScroll");var i=h.width()-15;var j=h.height()-35;d.width=i;d.height=j;f.obj.tabContainer().insertAfter(jQuery('<div class="'+f.cl.fullScreen+" "+f.cl.uiFullScreen+'" />').append(d.parent.children()).appendTo("body")).addClass(f.cl.tabContainerFullScreen);d.parent=f.obj.fullScreen();f.sheetSyncSize()}},renameSpreadsheet:function(j){if(isNaN(j)){return false}if(j>-1){f.sheetTab()}},switchSpreadsheet:function(j){if(isNaN(j)){return false}if(j==-1){f.addSheet("5x10")}else{if(j!=f.i){f.setActiveSheet(j);f.calc(j)}}f.trigger("switchSheet",[j]);return false},tuneTableForSheetUse:function(i){i.addClass(f.cl.sheet).attr("id",f.id.sheet+f.i).attr("border","1px").attr("cellpadding","0").attr("cellspacing","0");i.find("td."+f.cl.cellActive).removeClass(f.cl.cellActive);return i},attrH:{width:function(j,i){return jQuery(j).outerWidth()-(i?0:d.boxModelCorrection)},widthReverse:function(j,i){return jQuery(j).outerWidth()+(i?0:d.boxModelCorrection)},height:function(j,i){return jQuery(j).outerHeight()-(i?0:d.boxModelCorrection)},heightReverse:function(j,i){return jQuery(j).outerHeight()+(i?0:d.boxModelCorrection)},syncSheetWidthFromTds:function(j){var i=0;j=(j?j:f.obj.sheet());j.find("col").each(function(){i+=jQuery(this).width()});j.width(i);return i},setHeight:function(m,s,l,j){var p=0;var n=0;var r;switch(s){case"cell":j=(j?j:f.obj.barLeft().children().eq(m));n=f.attrH.height(jQuery(f.getTd(f.i,m,0)).parent().andSelf(),l);break;case"bar":if(!j){var q=jQuery(f.getTd(f.i,m,0)).parent();var k=q.children();j=q.add(k)}n=f.attrH.heightReverse(f.obj.barLeft().children().eq(m),l);break}if(n){jQuery(j).height(n).css("height",n+"px").attr("height",n+"px")}return j}},setTdIds:function(k,j){if(!g||!k){k=f.obj.sheet();j=f.i}f.spreadsheets[j]=[];k.find("tr").each(function(i){jQuery(this).children().each(function(l){var m=jQuery(this).attr("id",f.getTdId(j,i,l));f.createCell(j,i,l,m.text(),m.attr("formula"))})})},setControlIds:function(){var i=function(j,k){j.each(function(l){jQuery(this).attr("id",k+l)})};i(f.obj.sheetAll().each(function(j){f.setTdIds(jQuery(this),j)}),f.id.sheet);i(f.obj.barTopAll(),f.id.barTop);i(f.obj.barTopParentAll(),f.id.barTopParent);i(f.obj.barLeftAll(),f.id.barLeft);i(f.obj.barLeftParentAll(),f.id.barLeftParent);i(f.obj.barCornerAll(),f.id.barCorner);i(f.obj.barCornerParentAll(),f.id.barCornerParent);i(f.obj.tableControlAll(),f.id.tableControl);i(f.obj.paneAll(),f.id.pane);i(f.obj.tabAll().each(function(k){jQuery(this).attr("i",k)}),f.id.tab)},toggleHide:{row:function(j){if(!j){j=f.obj.cellActive().parent().attr("rowIndex")}if(j){var k=f.obj.barLeft().children().eq(j);if(k.is(":visible")){k.hide();f.obj.sheet().find("tr").eq(j).hide()}else{k.show();f.obj.sheet().find("tr").eq(j).show()}}else{alert(f.msg.toggleHideRow)}},rowAll:function(){f.obj.sheet().find("tr").show();f.obj.barLeft().children().show()},column:function(j){if(!j){j=f.obj.cellActive().attr("cellIndex")}if(j){var k=f.obj.barTop().children().eq(j);if(k.is(":visible")){f.obj.sheet().find("tbody tr").each(function(){jQuery(this).children().eq(j).hide()});k.hide();f.obj.sheet().find("colgroup col").eq(j).hide();f.toggleHide.columnSizeManage()}}else{alert(f.msg.toggleHideColumn)}},columnAll:function(){},columnSizeManage:function(){var i=f.obj.barTop().width();var j=0;var j=0;f.obj.barTop().children().each(function(){var k=jQuery(this);if(k.is(":hidden")){j+=k.width()}});f.obj.barTop().width(i);f.obj.sheet().width(i)}},merge:function(){var m="";var r="";var s=f.obj.cellHighlighted();var p;var j=f.getTdLocation(s.first());var k=f.getTdLocation(s.last());var o=(k.col-j.col)+1;if(s.length>1&&j.row){for(var n=j.col;n<=k.col;n++){var l=jQuery(f.getTd(f.i,j.row,n)).hide();var q=f.spreadsheets[f.i][j.row][n];m=(q.formula?"("+q.formula.replace("=","")+")":q.value)+m;if(n!=j.col){q.formula=null;q.value;l.attr("formula","").html("").hide()}}var q=s.first().show().attr("colspan",o).html(m);f.setDirty(true);f.calc()}else{if(!j.row){alert(f.msg.merge)}}},unmerge:function(){var r=f.obj.cellHighlighted().first();var m=f.getTdLocation(r);var o=r.attr("formula");var q=r.text();q=(o?o:q);var p=r.attr("rowspan");var n=r.attr("colspan");n=parseInt(n?n:1);var j="<td />";var l="";if(n){for(var k=0;k<n;k++){l+=j}}for(var k=m.col;k<n;k++){jQuery(f.getTd(f.i,m.row,k)).show()}r.removeAttr("colspan");f.setDirty(true);f.calc()},fillUpOrDown:function(p,o,q){var s=f.obj.cellHighlighted();var i=f.obj.cellActive();f.cellUndoable.add(s);var r=i.hasClass(f.cl.uiCellHighlighted);var m=f.getTdLocation(s.first());var t=f.getTdLocation(s.last());q=(q?q:f.obj.formula().val());var l={row:0,col:0};var k;var j=q;var n;if(q.charAt(0)=="="){n=function(v,w,u){k=jQuery(this);if(p){l.row=-t.row+w;l.col=-t.col+u}else{l.row=w-m.row;l.col=u-m.col}j=f.reparseFormula(q,l);f.spreadsheets[v][w][u].formula=j;k.attr("formula",j).html("")}}else{if(p&&!isNaN(j)){j*=1;j-=t.row;j-=t.col}n=function(v,w,u){k=jQuery(this);f.spreadsheets[v][w][u].formula=null;f.spreadsheets[v][w][u].value=j;k.removeAttr("formula").html(j);if(!isNaN(j)){j++}}}f.cycleCells(n,m,t);f.setDirty(true);f.calc();f.cellUndoable.add(s)},offsetFormulas:function(o,n,j){var i=f.sheetSize();var m={first:o,last:{row:i.height,col:i.width}};var k={first:{row:0,col:0},last:{row:i.height,col:i.width}};f.log("offsetFormulas from - Col:"+o.col+",Row:"+o.row);f.log("Is before loc:"+(j?"true":"false"));f.log("Offset: - Col:"+n.col+",Row:"+n.row);function l(r,p){var q=false;if(j){if(r>=p){q=true}}else{if(r>p){q=true}}return q}f.cycleCells(function(q,r,p){var t=jQuery(this);var s=t.attr("formula");if(s&&f.isFormulaEditable(t)){s=f.reparseFormula(s,n,function(u){return{row:l(u.row,o.row),col:l(u.col,o.col)}});f.spreadsheets[q][r][p].formula=s;t.attr("formula",s)}},k.first,k.last);f.evt.cellEditDone();f.calc()},reparseFormula:function(k,j,i){return k.replace(jSE.regEx.cell,function(m,n,p,q){var o=jSE.parseLocation(m);if(i){var l=i(o);if(l.col||l.row){if(l.col){o.col+=j.col}if(l.row){o.row+=j.row}return f.makeFormula(o)}}else{return f.makeFormula(o,j)}return m})},makeFormula:function(j,i){i=jQuery.extend({row:0,col:0},i);j.col+=i.col;j.row+=i.row;if(j.col<0){j.col=0}if(j.row<0){j.row=0}return jSE.parseCellName(j.col,j.row)},cycleCells:function(l,o,m,k){k=(k?k:f.i);o=(o?o:{row:0,col:0});if(!m){var j=f.sheetSize(jQuery("#"+f.id.sheet+k));m={row:j.height,col:j.width}}for(var n=o.row;n<=m.row;n++){for(var i=o.col;i<=m.col;i++){var p=f.getTd(k,n,i);if(p){l.apply(p,[k,n,i])}}}},cycleCellsAll:function(m){for(var l=0;l<=f.sheetCount;l++){var k=f.sheetSize(jQuery("#"+f.id.sheet+l));var j={row:k.height,col:k.width};f.cycleCells(m,{row:0,col:0},j,l)}},cycleCellsAndMaintainPoint:function(m,q,n){var p=[];for(var l=(q.row<n.row?q.row:n.row);l<=(q.row>n.row?q.row:n.row);l++){for(var k=(q.col<n.col?q.col:n.col);k<=(q.col>n.col?q.col:n.col);k++){p.push(f.getTd(f.i,l,k));m(p[p.length-1])}}return p},addTab:function(){jQuery('<span class="'+f.cl.uiTab+' ui-corner-bottom"><a class="'+f.cl.tab+'" id="'+f.id.tab+f.i+'" i="'+f.i+'">'+f.sheetTab(true)+"</a></span>").insertBefore(f.obj.tabContainer().find("span:last"))},sheetDecorate:function(i){f.formatSheet(i);f.sheetSyncSizeToCols(i);f.sheetDecorateRemove()},formatSheet:function(k){var i=0;if(k.find("tbody").length<1){k.wrapInner("<tbody />")}if(k.find("colgroup").length<1||k.find("col").length<1){k.remove("colgroup");var j=jQuery("<colgroup />");k.find("tr:first").children().each(function(){var l=d.newColumnWidth;jQuery("<col />").width(l).css("width",(l)+"px").attr("width",(l)+"px").appendTo(j);i+=l});k.find("tr").each(function(){jQuery(this).height(d.colMargin).css("height",d.colMargin+"px").attr("height",d.colMargin+"px")});j.prependTo(k)}k.removeAttr("width").css("width","").width(i)},checkMinSize:function(k){var j=f.sheetSize();var l=0;var i=0;if((j.width)<d.minSize.cols){i=d.minSize.cols-j.width-1}if(i){f.controlFactory.addColumnMulti(i,false,true)}if((j.height)<d.minSize.rows){l=d.minSize.rows-j.height-1}if(l){f.controlFactory.addRowMulti(l,false,true)}},themeRoller:{start:function(){d.parent.addClass(f.cl.uiParent);f.obj.sheet().addClass(f.cl.uiSheet);f.obj.barLeft().children().addClass(f.cl.uiBar);f.obj.barTop().children().addClass(f.cl.uiBar);f.obj.barCornerParent().addClass(f.cl.uiBar);f.obj.controls().addClass(f.cl.uiControl);f.obj.label().addClass(f.cl.uiControl);f.obj.formula().addClass(f.cl.uiControlTextBox)},cell:{setActive:function(){this.clearActive();this.setHighlighted(f.cellLast.td.addClass(f.cl.cellActive))},setHighlighted:function(i){jQuery(i).addClass(f.cl.cellHighlighted+" "+f.cl.uiCellHighlighted)},clearActive:function(){f.obj.cellActive().removeClass(f.cl.cellActive)},isHighlighted:function(){return(f.highlightedLast.td?true:false)},clearHighlighted:function(){if(f.themeRoller.cell.isHighlighted()){f.obj.cellHighlighted().removeClass(f.cl.cellHighlighted+" "+f.cl.uiCellHighlighted)}f.highlightedLast.rowStart=-1;f.highlightedLast.colStart=-1;f.highlightedLast.rowEnd=-1;f.highlightedLast.colEnd=-1;f.highlightedLast.td=jQuery("<td />")}},bar:{style:function(i){jQuery(i).addClass(f.cl.uiBar)},setActive:function(k,j){switch(k){case"top":f.obj.barTop().children().eq(j).addClass(f.cl.uiActive);break;case"left":f.obj.barLeft().children().eq(j).addClass(f.cl.uiActive);break}},clearActive:function(){f.obj.barTop().add(f.obj.barLeft()).children("."+f.cl.uiActive).removeClass(f.cl.uiActive)}},tab:{setActive:function(i){this.clearActive();f.obj.tab().parent().addClass(f.cl.uiTabActive)},clearActive:function(){f.obj.tabContainer().find("span."+f.cl.uiTabActive).removeClass(f.cl.uiTabActive)}},resize:function(){f.resizable(d.parent,{minWidth:d.width*0.5,minHeight:d.height*0.5,start:function(){f.obj.ui().hide()},stop:function(){f.obj.ui().show();d.width=d.parent.width();d.height=d.parent.height();f.sheetSyncSize()}});var i=jQuery("<span />");f.resizable(f.obj.formula().wrap(i).parent(),{minHeight:f.obj.formula().height(),maxHeight:78,handles:"s",resize:function(k,j){f.obj.formula().height(j.size.height);f.sheetSyncSize()}})}},resizable:function(j,i){if(j.attr("resizable")){j.resizable("destroy")}j.resizable(i).attr("resizable",true)},busy:false,draggable:function(j,i){if(j.attr("draggable")){j.resizable("destroy")}j.draggable(i).attr("draggable",true)},resizeBarTop:function(i){f.resizable(jQuery(i.target),{handles:"e",start:function(){f.busy=true;f.obj.barHelper().remove()},stop:function(m,l){f.busy=false;var k=f.getBarTopIndex(this);f.sheetSyncSizeToDivs();var j=f.attrH.width(this,true);f.obj.sheet().find("col").eq(k).width(j).css("width",j+"px").attr("width",j+"px");f.followMe();f.obj.pane().scroll()}})},resizeBarLeft:function(i){f.resizable(jQuery(i.target),{handles:"s",start:function(){f.busy=true;f.obj.barHelper().remove()},stop:function(l,k){f.busy=false;var j=f.getBarLeftIndex(jQuery(this));f.attrH.setHeight(j,"bar",true);f.attrH.setHeight(j,"cell");f.followMe();f.obj.pane().scroll()}})},sheetDecorateRemove:function(j){var i=(j?f.obj.sheetAll().clone():f.obj.sheetAll());jQuery(i).find("td."+f.cl.cellActive).removeClass(f.cl.cellActive+" "+f.cl.uiCellActive);jQuery(i).find("td."+f.cl.cellHighlighted).removeClass(f.cl.cellHighlighted+" "+f.cl.uiCellHighlighted);return i},labelUpdate:function(j,i){if(!i){f.obj.label().html(jSE.parseCellName(j.col,j.row))}else{f.obj.label().html(j)}},cellEdit:function(n,j,k){f.autoFillerNotGroup=true;f.evt.cellEditDone();f.followMe(n);f.obj.pane().scroll();var l=f.getTdLocation(n);f.labelUpdate(l);var i=n.attr("formula");if(!i){i=n.text()}var m=f.obj.formula().val(i).blur();if(!k){}f.cellSetActive(n,l,j)},cellSetActive:function(p,o,l,j,n){if(typeof(o.col)!="undefined"){f.cellLast.td=p;f.cellLast.row=f.rowLast=o.row;f.cellLast.col=f.colLast=o.col;f.themeRoller.bar.clearActive();f.themeRoller.cell.clearHighlighted();f.highlightedLast.td=p;f.themeRoller.cell.setActive();f.themeRoller.bar.setActive("left",f.cellLast.row);f.themeRoller.bar.setActive("top",f.cellLast.col);var i;var m;f.highlightedLast.rowStart=o.row;f.highlightedLast.colStart=o.col;f.highlightedLast.rowLast=o.row;f.highlightedLast.colLast=o.col;switch(d.cellSelectModel){case"excel":case"gdocs":i=function(){};m=f.themeRoller.cell.clearHighlighted;break;case"oo":i=function(q){var r=jQuery(q);if(f.isTd(r)){f.cellEdit(r)}};m=function(){};break}if(l){var k=o;f.obj.pane().mousemove(function(s){var q=f.getTdLocation([s.target]);var r=true;if(j){r=false;if(o.col==q.col||o.row==q.row){r=true}}if((k.col!=q.col||k.row!=q.row)&&r){m();f.highlightedLast.colEnd=q.col;f.highlightedLast.rowEnd=q.row;i(s.target);f.highlightedLast.td=f.cycleCellsAndMaintainPoint(f.themeRoller.cell.setHighlighted,o,q)}k=q});jQuery(document).one("mouseup",function(){f.obj.pane().unbind("mousemove").unbind("mouseup");if(jQuery.isFunction(n)){n()}})}}},colLast:0,rowLast:0,cellLast:{td:jQuery("<td />"),row:-1,col:-1,isEdit:false},highlightedLast:{td:jQuery("<td />"),rowStart:-1,colStart:-1,rowEnd:-1,colEnd:-1},cellStyleToggle:function(k,j){var i=f.obj.cellHighlighted();f.cellUndoable.add(i);if(j){i.removeClass(j)}if(i.hasClass(k)){i.removeClass(k)}else{i.addClass(k)}f.cellUndoable.add(i);return false},fontReSize:function(k){var i=0;switch(k){case"up":i=1;break;case"down":i=-1;break}var j=f.obj.cellHighlighted();f.cellUndoable.add(j);j.each(function(m){cell=jQuery(this);var l=(cell.css("font-size")+"").replace("px","");var n=parseInt(l?l:10)+i;cell.css("font-size",n+"px")});f.cellUndoable.add(j)},callStack:0,updateCellValue:function(k,n,j){if(!f.spreadsheets[k]){return"Error: Sheet not found"}if(!f.spreadsheets[k][n]){return"Error: Row not found"}if(!f.spreadsheets[k][n][j]){return"Error: Column not found"}var i=f.spreadsheets[k][n][j];i.oldValue=i.value;if(i.state){throw ("Error: Loop Detected")}i.state="red";if(i.calcCount<1&&i.calcLast!=f.calcLast){i.calcLast=f.calcLast;i.calcCount++;if(i.formula){try{if(i.formula.charAt(0)=="="){i.formula=i.formula.substring(1,i.formula.length)}var m;if(f.callStack){if(!i.parser){i.parser=(new f.parser)}m=i.parser}else{m=f.Parser}f.callStack++;m.lexer.cell={sheet:k,row:n,col:j,cell:i,s:d,editable:d.editable,jS:f};m.lexer.cellHandler=f.cellHandlers;i.value=m.parse(i.formula)}catch(l){i.value=l.toString().replace(/\n/g,"<br />");b.one("calculation",function(){f.attrH.setHeight(n,"cell",false)});f.alertFormulaError(i.value)}f.callStack--}if(i.html){jQuery(f.getTd(k,n,j)).html(i.html)}else{jQuery(f.getTd(k,n,j)).html(i.value)}}i.state=null;return i.value},cellHandlers:{cellValue:function(j){var i=jSE.parseLocation(j);return f.updateCellValue(this.sheet,i.row,i.col)},cellRangeValue:function(o){o=o.split(":");var p=jSE.parseLocation(o[0]);var l=jSE.parseLocation(o[1]);var k=[];for(var n=p.row;n<=l.row;n++){for(var m=p.col;m<=l.col;m++){k.push(f.updateCellValue(this.sheet,n,m))}}return[k]},fixedCellValue:function(i){return f.cellHandlers.cellValue.apply(this,[(i+"").replace(/[$]/g,"")])},fixedCellRangeValue:function(i){return f.cellHandlers.cellRangeValue.apply(this,[(i+"").replace(/[$]/g,"")])},remoteCellValue:function(k){var i,j;k=k.replace(jSE.regEx.remoteCell,function(o,n,m,l,p){i=(m*1)-1;j=jSE.parseLocation(l+p);return o});return f.updateCellValue(i,j.row,j.col)},remoteCellRangeValue:function(p){var o,q,l;p=p.replace(jSE.regEx.remoteCellRange,function(t,s,r,v,j,u,i){o=(r*1)-1;q=jSE.parseLocation(v+j);l=jSE.parseLocation(u+i);return t});var k=[];for(var n=q.row;n<=l.row;n++){for(var m=q.col;m<=l.col;m++){k.push(f.updateCellValue(o,n,m))}}return[k]},callFunction:function(k,j,i){if(!j){j=[""]}else{if(jQuery.isArray(j)){j=j.reverse()}else{j=[j]}}return(jQuery.sheet.fn[k]?jQuery.sheet.fn[k].apply(i,j):"Error: Function Not Found")}},alertFormulaError:function(i){alert("cell:"+row+" ;"+col+'\nvalue: "'+cell.formula+'"\nerror: \n'+e)},context:{},calcLast:0,calc:function(i){i=(i?i:f.i);if(f.readOnly[i]){return}f.log("Calculation Started");f.calcLast=new Date();jSE.calc(i,f.spreadsheetsToArray()[i],f.updateCellValue);f.trigger("calculation");f.isSheetEdit=false;f.log("Calculation Ended")},refreshLabelsColumns:function(){var i=0;f.obj.barTop().children().each(function(j){jQuery(this).text(jSE.columnLabelString(j));i+=jQuery(this).width()});return i},refreshLabelsRows:function(){f.obj.barLeft().children().each(function(j){jQuery(this).text((j+1))})},addSheet:function(i){i=(i?i:prompt(f.msg.newSheet));if(i){f.evt.cellEditAbandon();f.setDirty(true);var j=f.controlFactory.sheetUI(jQuery.sheet.makeTable.fromSize(i),f.sheetCount+1,function(k){f.setActiveSheet(f.sheetCount)},true);f.trigger("addSheet",[f.i])}},deleteSheet:function(){var i=f.i;f.obj.barHelper().remove();f.obj.tableControl().remove();f.obj.tabContainer().children().eq(f.i).remove();f.i=0;f.sheetCount--;f.setControlIds();f.setActiveSheet(f.i);f.setDirty(true);f.trigger("deleteSheet",[i])},deleteRow:function(i){var j=f.rowLast;f.obj.barLeft().children().eq(f.rowLast).remove();jQuery(f.getTd(f.i,f.rowLast,0)).parent().remove();f.refreshLabelsRows();f.setTdIds();f.obj.pane().scroll();f.offsetFormulas({row:f.rowLast,col:0},{row:-1,col:0});f.setDirty(true);f.evt.cellEditAbandon();f.trigger("deleteRow",j)},deleteColumn:function(k){var n=f.colLast;f.obj.barHelper().remove();f.obj.barTop().children().eq(f.colLast).remove();f.obj.sheet().find("colgroup col").eq(f.colLast).remove();var m=f.sheetSize();for(var l=0;l<=m.height;l++){jQuery(f.getTd(f.i,l,f.colLast)).remove()}var j=f.refreshLabelsColumns();f.setTdIds();f.obj.sheet().width(j);f.obj.pane().scroll();f.offsetFormulas({row:0,col:f.colLast},{row:0,col:-1});f.setDirty(true);f.evt.cellEditAbandon();f.trigger("deleteColumn",lastCol)},sheetTab:function(j){var i="";if(j){i=f.obj.sheet().attr("title");i=(i?i:"Spreadsheet "+(f.i+1))}else{if(f.isSheetEditable()&&d.editableTabs){var k=prompt("What would you like the sheet's title to be?",f.sheetTab(true));if(!k){i=f.obj.sheet().attr("title");k=(i?i:"Spreadsheet"+(f.i+1))}else{f.setDirty(true);f.obj.sheet().attr("title",k);f.obj.tab().html(k);i=k}}}return jQuery("<div />").text(i).html()},print:function(j){var i=window.open();i.document.write("<html><body><xmp>"+j+"\n</xmp></body></html>");i.document.close()},viewSource:function(j){var k=f.sheetDecorateRemove(true);var i="";if(j){jQuery(k).each(function(){i+=f.HTMLtoPrettySource(this)})}else{i+=jQuery("<div />").html(k).html()}f.print(i);return false},saveSheet:function(){var i=f.sheetDecorateRemove(true);var j=jQuery("<div />").html(i).html();jQuery.ajax({url:d.urlSave,type:"POST",data:"s="+j,dataType:"html",success:function(k){f.setDirty(false);f.trigger("saveSheet")}})},HTMLtoCompactSource:function(p){var k="";if(p.nodeType==1){k+="<"+p.tagName;m=false;var r=p.attributes.length;for(var o=0,m=false;o<r;o++){var l=p.attributes[o].name;var q=p.getAttribute(l);if(q){if(l=="contentEditable"&&q=="inherit"){continue}if(l=="class"){m=true}if(typeof(q)=="string"){k+=" "+l+'="'+q.replace(/"/g,"'")+'"'}else{if(l=="style"&&q.cssText){k+=' style="'+q.cssText+'"'}}}}if(p.tagName=="COL"){k+="/>"}else{k+=">";var j="";jQuery(p.childNodes).each(function(){j+=f.HTMLtoCompactSource(this)});k+=j;k+="</"+p.tagName+">"}}else{if(p.nodeType==3){k+=p.data.replace(/^\s*(.*)\s*$/g,"$1")}}return k},HTMLtoPrettySource:function(o,p){if(!p){p=""}var k="";if(o.nodeType==1){k+="\n"+p+"<"+o.tagName;var r=o.attributes.length;for(var m=0;m<r;m++){var l=o.attributes[m].name;var q=o.getAttribute(l);if(q){if(l=="contentEditable"&&q=="inherit"){continue}if(typeof(q)=="string"){k+=" "+l+'="'+q.replace(/"/g,"'")+'"'}else{if(l=="style"&&q.cssText){k+=' style="'+q.cssText+'"'}}}}if(o.childNodes.length<=0){k+="/>"}else{k+=">";var j="";var r=o.childNodes.length;for(var m=0;m<r;m++){j+=f.HTMLtoPrettySource(o.childNodes[m],p+"  ")}k+=j;if(j.indexOf("\n")>=0){k+="\n"+p}k+="</"+o.tagName+">"}}else{if(o.nodeType==3){k+=o.data.replace(/^\s*(.*)\s*$/g,"$1")}}return k},followMe:function(k){k=(k?k:jQuery(f.cellLast.td));var j=f.obj.pane();var m=j.offset();var q=j.width();var i=j.height();var p=k.offset();var o=k.width();var n=k.height();var l=20;if((p.left+o+l)>(m.left+q)){j.stop().scrollTo(k,{axis:"x",duration:50,offset:-((q-o)-l)})}else{if(p.left<m.left){j.stop().scrollTo(k,{axis:"x",duration:50})}}if((p.top+n+l)>(m.top+i)){j.stop().scrollTo(k,{axis:"y",duration:50,offset:-((i-n)-l)})}else{if(p.top<m.top){j.stop().scrollTo(k,{axis:"y",duration:50})}}f.autoFillerGoToTd(k,n,o)},autoFillerGoToTd:function(k,i,j){k=(k?k:jQuery(f.cellLast.td));i=(i?i:k.height());j=(j?j:k.width());if(d.autoFiller){if(k.attr("id")){tdPos=k.position();f.obj.autoFiller().show().css("top",((tdPos.top+(i?i:k.height())-3)+"px")).css("left",((tdPos.left+(j?j:k.width())-3)+"px"))}}},isRowHeightSync:[],setActiveSheet:function(j){j=(j?j:0);f.obj.tableControlAll().hide().eq(j).show();f.i=j;f.themeRoller.tab.setActive();if(!f.isRowHeightSync[j]){f.isRowHeightSync[j]=true;f.obj.sheet().find("tr").each(function(i){f.attrH.setHeight(i,"cell")})}f.readOnly[j]=f.obj.sheet().hasClass("readonly");f.sheetSyncSize()},openSheetURL:function(i){d.urlGet=i;return f.openSheet()},openSheet:function(l,i){if(!f.isDirty?true:confirm(f.msg.openSheet)){f.controlFactory.header();var k=function(n,m){if(n==(m-1)){f.i=0;f.setActiveSheet();f.themeRoller.resize();for(var n=0;n<=f.sheetCount;n++){f.calc(n)}f.trigger("sheetOpened",[n])}};if(!l){jQuery("<div />").load(d.urlGet,function(){var m=jQuery(this).find("table");m.each(function(n){f.controlFactory.sheetUI(jQuery(this),n,function(){k(n,m.length)},true)})})}else{var j=jQuery("<div />").html(l).children("table");j.show().each(function(m){f.controlFactory.sheetUI(jQuery(this),m,function(){k(m,j.length)},(i?true:false))})}f.setDirty(false);return true}else{return false}},newSheet:function(){var i=prompt(f.msg.newSheet);if(i){f.openSheet(jQuery.sheet.makeTable.fromSize(i))}},importRow:function(j){f.controlFactory.addRow(null,null,":last");var i="";f.obj.sheet().find("tr:last td").each(function(k){jQuery(this).removeAttr("formula");try{if((j[k]+"").charAt(0)=="="){jQuery(this).attr("formula",j[k])}else{jQuery(this).html(j[k])}}catch(l){i+=l+";\n"}});if(i){alert(i)}f.setTdIds();f.calc()},importColumn:function(i){f.controlFactory.addColumn();var j="";f.obj.sheet().find("tr").each(function(k){var m=jQuery(this).find("td:last");try{if((i[k]+"").charAt(0)=="="){m.attr("formula",i[k])}else{m.html(i[k])}}catch(l){j+=l+";\n"}});if(j){alert(j)}f.setTdIds();f.calc()},exportSheet:{xml:function(j){var l=f.sheetDecorateRemove(true);var i="";var k=["<![CDATA[","]]>"];if(j){k=["",""]}jQuery(l).each(function(){var r="";var p=jQuery(this);var o=0;var q="";p.find("colgroup").children().each(function(s){q+="<c"+s+">"+(jQuery(this).attr("width")+"").replace("px","")+"</c"+s+">"});var m=p.find("tr");var n=m.length;m.each(function(u){var t="";var x=jQuery(this);var w=x.attr("height");var s=(w?w:d.colMargin);var v=x.find("td");o=v.length;v.each(function(z){var E=jQuery(this);var B=E.attr("colspan");B=(B>1?B:"");var D=E.attr("formula");var C=(D?D:E.text());var y=E.attr("class");var A=E.attr("style");t+="<c"+z+(A?' style="'+A+'"':"")+(y?' class="'+y+'"':"")+(B?' colspan="'+B+'"':"")+">"+C+"</c"+z+">"});r+="<r"+u+' h="'+s+'">'+t+"</r"+u+">"});i+='<document title="'+p.attr("title")+'"><metadata><columns>'+o+"</columns><rows>"+n+"</rows><col_widths>"+q+"</col_widths></metadata><data>"+r+"</data></document>"});return"<documents>"+i+"</documents>"},json:function(){var j=f.sheetDecorateRemove(true);var i=[];jQuery(j).each(function(){var l={};l.metadata={};l.data={};var o=jQuery(this);var k=o.find("tr");var m=k.length;var n=0;var p="";k.each(function(q){var s=jQuery(this);var r=s.find("td");n=r.length;l.data["r"+q]={};l.data["r"+q]["h"]=s.attr("height");r.each(function(t){var w=jQuery(this);var u=w.attr("colspan");u=(u>1?u:null);var v=w.attr("formula");l.data["r"+q]["c"+t]={value:(v?v:w.text()),style:w.attr("style"),colspan:u,cl:w.attr("class")}})});l.metadata={columns:n,rows:m,title:o.attr("title"),col_widths:{}};o.find("colgroup").children().each(function(q){l.metadata["col_widths"]["c"+q]=(jQuery(this).attr("width")+"").replace("px","")});i.push(l)});return i},html:function(){return f.sheetDecorateRemove(true)}},sheetSyncSizeToDivs:function(){var i=0;f.obj.barTop().children().each(function(){i+=jQuery(this).width()-d.boxModelCorrection});f.obj.sheet().width(i).attr("width",i+"px").css("width",i+"px");return i},sheetSyncSizeToCols:function(i){var j=0;i=(i?i:f.obj.sheet());i.find("colgroup col").each(function(){j+=jQuery(this).width()});i.width(j)},sheetSyncSize:function(){var j=d.height;if(!j){j=400}else{if(j<200){j=200}}d.parent.height(j).width(d.width);var i=d.width-f.attrH.width(f.obj.barLeftParent())-(d.boxModelCorrection);j=j-f.attrH.height(f.obj.controls())-f.attrH.height(f.obj.barTopParent())-(d.boxModelCorrection*2);f.obj.pane().height(j).width(i).parent().width(i);f.obj.ui().width(i+f.attrH.width(f.obj.barLeftParent()));f.obj.barLeftParent().height(j);f.obj.barTopParent().width(i).parent().width(i)},cellChangeStyle:function(i,j){f.cellUndoable.add(f.obj.cellHighlighted());f.obj.cellHighlighted().css(i,j);f.cellUndoable.add(f.obj.cellHighlighted())},cellFind:function(i){if(!i){i=prompt("What are you looking for in this spreadsheet?")}if(i){var j=f.obj.sheet().find('td:contains("'+i+'")');if(j.length<1){j=f.obj.sheet().find('td:contains("'+i.toLowerCase()+'")')}if(j.length<1){j=f.obj.sheet().find('td:contains("'+i.toUpperCase()+'")')}j=j.eq(0);if(j.length>0){f.cellEdit(j)}else{alert(f.msg.cellFind)}}},cellSetActiveBar:function(n,j,l){var q=f.sheetSize(jQuery("#"+f.id.sheet+f.i));var m=(j<l?j:l);var o=(j<l?l:j);var i=function(v,s,u,r,t){switch(d.cellSelectModel){case"oo":f.cellEdit(jQuery(f.getTd(f.i,r,t)));break;default:f.cellEdit(jQuery(f.getTd(f.i,s,u)));break}i=function(w){return w};return v};var p;var k=[];switch(n){case"col":p=function(){for(var s=0;s<=q.height;s++){for(var r=m;r<=o;r++){k.push(f.getTd(f.i,s,r));f.themeRoller.cell.setHighlighted(i(k[k.length-1],0,j,0,l))}}};break;case"row":p=function(){for(var s=m;s<=o;s++){for(var r=0;r<=q.width;r++){k.push(f.getTd(f.i,s,r));f.themeRoller.cell.setHighlighted(i(k[k.length-1],j,0,l,0))}}};break;case"all":p=function(){i=function(t){f.cellEdit(jQuery(t));i=function(){}};for(var s=0;s<=q.height;s++){for(var r=0;r<=q.width;r++){k.push(f.getTd(f.i,s,r));i(k[k.length-1]);f.themeRoller.cell.setHighlighted(k[k.length-1])}}m={row:0,col:0};o={row:q.height,col:q.width}};break}p();f.highlightedLast.td=k;f.highlightedLast.rowStart=m.row;f.highlightedLast.colStart=m.col;f.highlightedLast.rowEnd=o.row;f.highlightedLast.colEnd=o.col},sheetClearActive:function(){f.obj.formula().val("");f.obj.barSelected().removeClass(f.cl.barSelected)},getTdRange:function(l,q,o,p){f.cellLast.isEdit=true;var j=function(s){if(s.first.col>s.last.col||s.first.row>s.last.row){return{first:jSE.parseCellName(s.last.col,s.last.row),last:jSE.parseCellName(s.first.col,s.first.row)}}else{return{first:jSE.parseCellName(s.first.col,s.first.row),last:jSE.parseCellName(s.last.col,s.last.row)}}};var n=function(v){var s=j(v);var u=q+"";u=(u.match(/=/)?u:"="+u);if(o||u.charAt(u.length-1)!="("){u=u+(o?o:"")+"("}var w;var t="";if(s.first!=s.last){w=s.first+":"+s.last}else{w=s.first}if(u.charAt(u.length-1)=="("){t=")"}return u+w+t};var i="";if(l){var k={first:f.getTdLocation([l.target])};var m=f.obj.sheet().mousemove(function(s){k.last=f.getTdLocation([s.target]);i=n(k);if(!p){f.obj.formula().val(i);f.obj.inPlaceEdit().val(i)}});jQuery(document).one("mouseup",function(){m.unbind("mousemove");return i})}else{var r=f.obj.cellHighlighted().not(f.obj.cellActive());if(r.length){var k={first:f.getTdLocation(r.first()),last:f.getTdLocation(r.last())};i=n(k);if(!p){f.obj.formula().val(i);f.obj.inPlaceEdit().val(i)}return i}else{return""}}},getTdId:function(i,k,j){return c+"_table"+i+"_cell_c"+j+"_r"+k},getTd:function(i,k,j){return document.getElementById(f.getTdId(i,k,j))},getTdLocation:function(i){if(!i||!i[0]){return{col:0,row:0}}return{col:parseInt(i[0].cellIndex),row:parseInt(i[0].parentNode.rowIndex)}},getTdFromXY:function(k,j,l){var n=f.obj.pane();var i=(l?{left:0,top:0}:n.offset());j+=i.top+2;k+=i.left+2;if((j>=i.top&&j<=i.top+n.height())&&(k>=i.left&&k<=i.left+n.width())){var m=jQuery(document.elementFromPoint(k-h.scrollLeft(),j-h.scrollTop()));if(f.isTd(m)){return m}return false}},getBarLeftIndex:function(k){var j=jQuery.trim(jQuery(k).text());if(isNaN(j)){return -1}else{return j-1}},getBarTopIndex:function(l){var j=jQuery.trim(jQuery(l).text());if(!j){return -1}var k=jSE.columnLabelIndex(j);k=parseInt(k);if(isNaN(k)){return -1}else{return k}},EMPTY_VALUE:{},time:{now:new Date(),last:new Date(),diff:function(){return Math.abs(Math.ceil(this.last.getTime()-this.now.getTime())/1000).toFixed(5)},set:function(){this.last=this.now;this.now=new Date()},get:function(){return this.now.getHours()+":"+this.now.getMinutes()+":"+this.now.getSeconds()}},log:function(i){f.time.set();console.log(f.time.get()+", "+f.time.diff()+"; "+i)},replaceWithSafeImg:function(i){(i?i:f.obj.sheet().find("img")).each(function(){var j=jQuery(this).attr("src");jQuery(this).replaceWith(f.controlFactory.safeImg(j,f.getTdLocation(jQuery(this).parent()).row))})},isDirty:false,setDirty:function(i){f.isDirty=i},appendToFormula:function(i,k){var l=f.obj.formula();var j=l.val();if(j.charAt(0)!="="){j="="+j}l.val(j+i)},cellUndoable:{undoOrRedo:function(i){if(d.autoFiller){f.obj.autoFiller().hide()}if(i&&this.i>0){this.i--;this.i--}else{if(!i&&this.i<this.stack.length){this.i++;this.i++}}this.get().clone().each(function(){var j=jQuery(this);var k=j.attr("undoable");if(k){jQuery("#"+k).replaceWith(j.removeAttr("undoable").attr("id",k))}else{f.log("Not available.")}});f.themeRoller.cell.clearActive();f.themeRoller.bar.clearActive();f.themeRoller.cell.clearHighlighted();f.calc()},get:function(){return jQuery(this.stack[this.i])},add:function(k){var l=k.clone().each(function(){var i=jQuery(this);var m=i.attr("id");i.removeAttr("id").attr("undoable",m).removeClass(f.cl.cellHighlighted+" "+f.cl.uiCellHighlighted)});this.stack[this.i++]=l;if(this.stack.length>this.i){for(var j=this.stack.length;j>this.i;j--){this.stack.pop()}}if(this.stack.length>20){this.stack.shift()}},i:0,stack:[]},sheetSize:function(j){var i=f.getTdLocation((j?j:f.obj.sheet()).find("td:last"));return{width:i.col,height:i.row}},toggleState:function(i){if(d.allowToggleState){if(d.editable){f.evt.cellEditAbandon();f.saveSheet()}f.setDirty(false);d.editable=!d.editable;f.obj.tabContainer().remove();var j=(i?i:f.obj.sheetAll().clone());b.children().remove();f.openSheet(j,true)}},setCellRef:function(i){var j=f.obj.cellActive();loc=f.getTdLocation(j);cellRef=(i?i:prompt("Enter the name you would like to reference the cell by."));if(cellRef){f.spreadsheets[cellRef]=f.spreadsheets[f.i][loc.row][loc.col]}f.calc()}};var h=jQuery(window);var g;var a=function(){};f.lexer=function(){};f.lexer.prototype=parser.lexer;f.parser=function(){this.lexer=new f.lexer();this.yy={}};f.parser.prototype=parser;f.Parser=new f.parser;if(d.buildSheet){if(typeof(d.buildSheet)=="object"){g=d.buildSheet}else{if(d.buildSheet==true||d.buildSheet=="true"){g=jQuery(d.parent.html())}else{if(d.buildSheet.match(/x/i)){g=jQuery.sheet.makeTable.fromSize(d.buildSheet)}}}}d.origParent=b;d.parent.html("").addClass(f.cl.parent);b.bind("switchSpreadsheet",function(l,k,j){f.switchSpreadsheet(j)}).bind("renameSpreadsheet",function(l,k,j){f.renameSpreadsheet(j)});d.width=(d.width?d.width:d.parent.width());d.height=(d.height?d.height:d.parent.height());if(!d.log){f.log=a}if(!jQuery.ui||!d.resizable){f.resizable=f.draggable=a}if(!jQuery.support.boxModel){d.boxModelCorrection=0}if(!jQuery.scrollTo){f.followMe=a}if(!d.barMenus){f.controlFactory.barTopMenu=f.controlFactory.barLeftMenu=a}if(!d.freezableCells){f.controlFactory.barTopHandle=f.controlFactory.barLeftHandle=a}if(d.calcOff){f.calc=a}if(!Raphael){jSE.chart=a}h.resize(function(){if(f){d.width=d.parent.width();d.height=d.parent.height();f.sheetSyncSize()}});if(jQuery.sheet.fn){jQuery.sheet.fn=jQuery.extend(jQuery.sheet.fn,d.calculations);if(jQuery.sheet.advancedfn){jQuery.sheet.fn=jQuery.extend(jQuery.sheet.fn,jQuery.sheet.advancedfn)}if(jQuery.sheet.financefn){jQuery.sheet.fn=jQuery.extend(jQuery.sheet.fn,jQuery.sheet.financefn)}}if(!d.alertFormulaErrors){f.alertFormulaError=a}f.openSheet(g,d.forceColWidthsOnStartup);f.s=d;return f},makeTable:{xml:function(b){var a=jQuery("<div />");jQuery(b).find("document").each(function(u){var z=jQuery("<table />");var y=0;var m=jQuery("<colgroup />").appendTo(z);var d=jQuery("<tbody />");var s=jQuery(this).find("metadata");var A=s.find("columns").text();var n=s.find("rows").text();var C=jQuery(this).attr("title");var B=jQuery(this).find("data");var f=s.find("col_widths").children();for(var u=0;u<parseInt(jQuery.trim(A));u++){var o=parseInt(f.eq(u).text().replace("px",""));o=(o?o:120);y+=o;m.append('<col width="'+o+'px" style="width: '+o+'px;" />')}z.width(y).attr("title",C);for(var u=0;u<n;u++){var v=B.find("r"+u);var q=(B.attr("h")+"").replace("px","");q=parseInt(q);var t=jQuery('<tr height="'+(q?q:18)+'px" />');for(var r=0;r<A;r++){var g="<td />";var k=v.find("c"+r);if(k){var p=k.text()+"";var l=k.attr("class");var x=k.attr("style");var h=k.attr("colspan");var c="";if(p.charAt(0)=="="){c=' formula="'+p+'"'}g="<td"+c+(x?' style="'+x+'"':"")+(l?' class="'+l+'"':"")+(h?' colspan="'+h+'"':"")+(q?' height="'+q+'px"':"")+">"+p+"</td>"}t.append(g)}d.append(t)}z.append(d).appendTo(a)});return a.children()},json:function(data,makeEval){sheet=(makeEval==true?eval("("+data+")"):data);var tables=jQuery("<div />");sheet=(jQuery.isArray(sheet)?sheet:[sheet]);for(var i=0;i<sheet.length;i++){var colCount=parseInt(sheet[i].metadata.columns);var rowCount=parseInt(sheet[i].metadata.rows);title=sheet[i].metadata.title;title=(title?title:"Spreadsheet "+i);var table=jQuery("<table />");var tableWidth=0;var colgroup=jQuery("<colgroup />").appendTo(table);var tbody=jQuery("<tbody />");if(sheet[i]["metadata"]["col_widths"]){for(var x=0;x<colCount;x++){var w=120;if(sheet[i]["metadata"]["col_widths"]["c"+x]){var newW=parseInt(sheet[i]["metadata"]["col_widths"]["c"+x].replace("px",""));w=(newW?newW:120);tableWidth+=w}colgroup.append('<col width="'+w+'px" style="width: '+w+'px;" />')}}table.attr("title",title).width(tableWidth);for(var x=0;x<rowCount;x++){var tr=jQuery("<tr />").appendTo(table);tr.attr("height",(sheet[i]["data"]["r"+x].h?sheet[i]["data"]["r"+x].h:18));for(var y=0;y<colCount;y++){var cell=sheet[i]["data"]["r"+x]["c"+y];var cur_val;var colSpan;var style;var cl;if(cell){cur_val=cell.value+"";colSpan=cell.colSpan+"";style=cell.style+"";cl=cell.cl+""}var cur_td=jQuery("<td"+(style?' style="'+style+'"':"")+(cl?' class="'+cl+'"':"")+(colSpan?' colspan="'+colSpan+'"':"")+" />");try{if(typeof(cur_val)=="number"){cur_td.html(cur_val)}else{if(cur_val.charAt(0)=="="){cur_td.attr("formula",cur_val)}else{cur_td.html(cur_val)}}}catch(e){}tr.append(cur_td)}}tables.append(table)}return tables.children()},fromSize:function(n,f,l){if(!n){n="5x10"}n=n.toLowerCase().split("x");var b=parseInt(n[0]);var g=parseInt(n[1]);var m=jQuery("<table />");var a="<td></td>";var d="";for(var c=b;c>=1;c--){d+=a}var k="<tr"+(f?' height="'+f+'px" style="height: '+f+'px;"':"")+">"+d+"</tr>";var j="";for(var c=g;c>=1;c--){j+=k}m.html("<tbody>"+j+"</tbody>");if(l){m.width(b*l)}return m}},killAll:function(){if(jQuery.sheet){if(jQuery.sheet.instance){for(var a=0;a<jQuery.sheet.instance.length;a++){if(jQuery.sheet.instance[a]){if(jQuery.sheet.instance[a].kill){jQuery.sheet.instance[a].kill()}}}}}},paneScrollLocker:function(b,a){var c=a.obj.pane();jQuery(jQuery.sheet.instance).each(function(d){if(a.I==d){return}this.obj.pane().scrollLeft(c.scrollLeft()).scrollTop(c.scrollTop())})},switchSheetLocker:function(b,a){jQuery(jQuery.sheet.instance).each(function(c){if(a.I==c){return}this.setActiveSheet(a.i)})},I:function(){var a=0;if(this.instance){a=(this.instance.length===0?0:this.instance.length-1)}else{this.instance=[]}return a}};var jSE=jQuery.sheet.engine={calc:function(c,f,g,a){for(var d=0;d<f.length;d++){for(var b=0;b<f[d].length;b++){f[d][b].calcCount=0}}for(var d=0;d<f.length;d++){for(var b=0;b<f[d].length;b++){g(c,d,b)}}},parseLocation:function(b){for(var a=0;a<b.length;a++){if(b.charCodeAt(a)<=57){break}}return{row:parseInt(b.substring(a))-1,col:this.columnLabelIndex(b.substring(0,a))}},parseCellName:function(a,b){return jSE.columnLabelString(a)+(b+1)},columnLabelIndex:function(c){var a=0;for(var b=0;b<c.length;b++){var d=c.toUpperCase().charCodeAt(b)-65;a=(a*26)+d}return(a>=0?a:0)},columnLabelString:function(f){var d=(f).toString(26).toUpperCase();var h=[];for(var g=0;g<d.length;g++){var a=d.charCodeAt(g);if(g<=0&&d.length>1){a=a-1}if(a<=57){h.push(String.fromCharCode(a-48+65))}else{h.push(String.fromCharCode(a+10))}}return h.join("")},cFN:{sum:function(a,b){return a+b},max:function(a,b){return a>b?a:b},min:function(a,b){return a<b?a:b},count:function(a,b){return(b!=null)?a+1:a},divide:function(a,b){return a/b},clean:function(a){if(typeof(a)=="string"){a=a.replace(jSE.regEx.amp,"&").replace(jSE.regEx.nbsp," ").replace(/\n/g,"").replace(/\r/g,"")}return a},sanitize:function(a){if(a){if(isNaN(a)){return a}else{return a*1}}return""}},regEx:{n:/[\$,\s]/g,cell:/\$?([a-zA-Z]+)\$?([0-9]+)/gi,range:/\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCell:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCellRange:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,sheet:/SHEET/i,amp:/&/g,gt:/</g,lt:/>/g,nbsp:/&nbsp;/g},str:{amp:"&amp;",lt:"&lt;",gt:"&gt;",nbsp:"&nbps;"},chart:function(d){var c=this.jS;var a=this;function b(f,g){if(!f){if(g){f=0}else{f=""}}else{if(g){f=arrHelpers.toNumbers(f)}else{f=arrHelpers.flatten(f)}}return f}d=jQuery.extend({x:{legend:"",data:[0]},y:{legend:"",data:[0]},title:"",data:[0],legend:"",chart:jQuery('<div class="'+c.cl.chart+'" />').mousedown(function(){jQuery(this).parent().mousedown()}).mousemove(function(){jQuery(this).parent().mousemove();return false})},d);d.data=b(d.data,true);d.x.data=b(d.x.data,true);d.y.data=b(d.y.data,true);d.legend=b(d.legend);d.x.legend=b(d.x.legend);d.y.legend=b(d.y.legend);d.legend=(d.legend?d.legend:d.data);this.s.origParent.one("calculation",function(){var h=d.chart.width();var f=d.chart.height();var i=Raphael(d.chart[0]);if(i.g){if(d.title){i.g.text(h/2,10,d.title).attr({"font-size":20})}switch(d.type){case"bar":i.g.barchart(h/8,f/8,h*0.8,f*0.8,d.data,d.legend).hover(function(){this.flag=i.g.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"hbar":i.g.hbarchart(h/8,f/8,h*0.8,f*0.8,d.data,d.legend).hover(function(){this.flag=i.g.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"line":i.g.linechart(h/8,f/8,h*0.8,f*0.8,d.x.data,d.y.data,{nostroke:false,axis:"0 0 1 1",symbol:"o",smooth:true}).hoverColumn(function(){this.tags=i.set();try{for(var j=0;j<this.y.length;j++){this.tags.push(i.g.tag(this.x,this.y[j],this.values[j],0,10).insertBefore(this).attr([{fill:"#fff"},{fill:this.symbols[j].attr("fill")}]))}}catch(k){}},function(){this.tags&&this.tags.remove()});break;case"pie":var g=i.g.piechart(h/2,f/2,(h<f?h:f)/2,d.data,{legend:d.legend}).hover(function(){this.sector.stop();this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label){this.label[0].stop();this.label[0].scale(1.5);this.label[1].attr({"font-weight":800})}},function(){this.sector.animate({scale:[1,1,this.cx,this.cy]},500,"bounce");if(this.label){this.label[0].animate({scale:1},500,"bounce");this.label[1].attr({"font-weight":400})}});break;case"dot":i.g.dotchart(h/8,f/8,h*0.8,f*0.8,d.x.data,d.y.data,d.data,{symbol:"o",max:10,heat:true,axis:"0 0 1 1",axisxstep:d.x.data.length-1,axisystep:d.y.data.length-1,axisxlabels:(d.x.legend?d.x.legend:d.x.data),axisylabels:(d.y.legend?d.y.legend:d.y.data),axisxtype:" ",axisytype:" "}).hover(function(){this.tag=this.tag||i.g.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this);this.tag.show()},function(){this.tag&&this.tag.hide()});break}c.attrH.setHeight(a.row,"cell",false)}});return d.chart}};var jFN=jQuery.sheet.fn={VERSION:function(){return this.jS.version},IMG:function(a){return jQuery("<img />").attr("src",a)},AVERAGE:function(b){var a=arrHelpers.foldPrepare(b,arguments);return jFN.SUM(a)/jFN.COUNT(a)},AVG:function(a){return jFN.AVERAGE(a)},COUNT:function(a){return arrHelpers.fold(arrHelpers.foldPrepare(a,arguments),jSE.cFN.count,0)},COUNTA:function(){var c=0;var a=arrHelpers.flatten(arguments);for(var b=0;b<a.length;b++){if(a[b]){c++}}return c},SUM:function(a){return arrHelpers.fold(arrHelpers.foldPrepare(a,arguments),jSE.cFN.sum,0,true,jFN.N)},MAX:function(a){return arrHelpers.fold(arrHelpers.foldPrepare(a,arguments),jSE.cFN.max,Number.MIN_VALUE,true,jFN.N)},MIN:function(a){return arrHelpers.fold(arrHelpers.foldPrepare(a,arguments),jSE.cFN.min,Number.MAX_VALUE,true,jFN.N)},MEAN:function(a){return this.SUM(a)/a.length},ABS:function(a){return Math.abs(jFN.N(a))},CEILING:function(a){return Math.ceil(jFN.N(a))},FLOOR:function(a){return Math.floor(jFN.N(a))},INT:function(a){return Math.floor(jFN.N(a))},ROUND:function(b,a){return jFN.FIXED(b,(a?a:0),false)},RAND:function(){return Math.random()},RND:function(){return Math.random()},TRUE:function(){return"TRUE"},FALSE:function(){return"FALSE"},NOW:function(){return new Date()},TODAY:function(){return Date(Math.floor(new Date()))},DAYSFROM:function(b,c,a){return Math.floor((new Date()-new Date(b,(c-1),a))/86400000)},DAYS:function(f,c){var b=new Date(f);var a=new Date(c);var d=1000*60*60*24;return Math.round(Math.abs(b.getTime()-a.getTime())/d)},DATEVALUE:function(a){var b=new Date(a);return b.getDate()+"/"+(b.getMonth()+1)+"/"+b.getFullYear()},IF:function(c,b,a){return(c?b:a)},FIXED:function(j,c,k){if(c==null){c=2}var h=Math.pow(10,c);var b=String(Math.round(jFN.N(j)*h)/h);var a=b.indexOf(".");if(a<0){a=b.length;b+="."}for(var d=b.length-a-1;d<c;d++){b+="0"}if(k==true){return b}var g=b.replace("-","").split(".");var l=[];var f=true;while(g[0].length>0){if(!f){l.unshift(",")}l.unshift(g[0].slice(-3));g[0]=g[0].slice(0,-3);f=false}if(c>0){l.push(".");var f=true;while(g[1].length>0){if(!f){l.push(",")}l.push(g[1].slice(0,3));g[1]=g[1].slice(3);f=false}}if(j<0){return"-"+l.join("")}return l.join("")},TRIM:function(a){if(typeof(a)=="string"){a=jQuery.trim(a)}return a},HYPERLINK:function(b,a){a=(a?a:"LINK");return jQuery('<a href="'+b+'" target="_new">'+a+"</a>")},DOLLAR:function(b,a,d){if(a==null){a=2}if(d==null){d="$"}var c=jFN.FIXED(b,a,false);if(b>=0){this.cell.html=d+c}else{this.cell.html="-"+d+c.slice(1)}return b},VALUE:function(a){return parseFloat(a)},N:function(a){if(a==null){return 0}if(a instanceof Date){return a.getTime()}if(typeof(a)=="object"){a=a.toString()}if(typeof(a)=="string"){a=parseFloat(a.replace(jSE.regEx.n,""))}if(isNaN(a)){return 0}if(typeof(a)=="number"){return a}if(a==true){return 1}return 0},PI:function(){return Math.PI},POWER:function(a,b){return Math.pow(a,b)},SQRT:function(a){return Math.sqrt(a)},DROPDOWN:function(b,f){b=arrHelpers.foldPrepare(b,arguments,true);var a=this.cell;var d=this.jS;if(this.s.editable){var h="dropdown"+this.sheet+"_"+this.row+"_"+this.col+"_"+this.jS.I;var g=jQuery('<select style="width: 100%;" name="'+h+'" id="'+h+'" />').mousedown(function(){d.cellEdit(jQuery(this).parent(),null,true)});if(!f){g.append('<option value="">Select a value</option>')}for(var c=0;c<(b.length<=50?b.length:50);c++){if(b[c]){g.append('<option value="'+b[c]+'">'+b[c]+"</option>")}}if(jQuery(d.getTd(this.sheet,this.row,this.col)).find("#"+h).length==0){a.selectedValue=d.spreadsheets[this.sheet][this.row][this.col].value}d.s.origParent.one("calculation",function(){jQuery("#"+h).change(function(){a.selectedValue=jQuery(this).val();d.calc()});d.attrH.setHeight(d.getTdLocation(g.parent()).row,"cell",false)});g.val(a.selectedValue);this.cell.html=g}return a.selectedValue},RADIO:function(c){c=arrHelpers.foldPrepare(c,arguments,true);var a=this.cell;var f=this.jS;if(this.s.editable){var h="radio"+this.sheet+"_"+this.row+"_"+this.col+"_"+this.jS.I;var g=jQuery("<span />").mousedown(function(){f.cellEdit(jQuery(this).parent())});for(var d=0;d<(c.length<=25?c.length:25);d++){if(c[d]){var b=jQuery('<input type="radio" name="'+h+'" class="'+h+'" />').val(c[d]);if(c[d]==a.selectedValue){b.attr("checked","true")}g.append(b).append("<span>"+c[d]+"</span>").append("<br />");f.s.origParent.one("calculation",function(){jQuery("."+h).change(function(){a.selectedValue=jQuery(this).val();f.calc()});f.attrH.setHeight(f.getTdLocation(g.parent()).row,"cell",false)})}}if(jQuery(f.getTd(this.sheet,this.row,this.col)).find("."+h).length==0){a.selectedValue=f.spreadsheets[this.sheet][this.row][this.col].value}this.cell.html=g}return a.selectedValue},CHECKBOX:function(b){b=arrHelpers.foldPrepare(b,arguments)[0];var a=this.cell;var f=this.jS;if(this.s.editable){var i="checkbox"+this.sheet+"_"+this.row+"_"+this.col+"_"+this.jS.I;var d=jQuery('<input type="checkbox" name="'+i+'" class="'+i+'" />').val(b);var g=jQuery("<span />").append(d).append("<span>"+b+"</span><br />").mousedown(function(){f.cellEdit(jQuery(this).parent())});if(b==a.selectedValue){d.attr("checked",true)}var h=jQuery(f.getTd(this.sheet,this.row,this.col));if(!h.children().length){if(h.text()==a.selectedValue){d.attr("checked",true)}}f.s.origParent.one("calculation",function(){jQuery("."+i).change(function(){a.selectedValue=(jQuery(this).is(":checked")?jQuery(this).val():"");f.calc()})});if(jQuery(f.getTd(this.sheet,this.row,this.col)).find("."+i).length==0){var c=f.spreadsheets[this.sheet][this.row][this.col].value;a.selectedValue=(c=="true"||c==true?b:"")}this.cell.html=g}return a.selectedValue},BARCHART:function(a,b,c){return jSE.chart.apply(this,[{type:"bar",data:a,legend:b,title:c}])},HBARCHART:function(a,b,c){return jSE.chart.apply(this,[{type:"hbar",data:a,legend:b,title:c}])},LINECHART:function(b,a){return jSE.chart.apply(this,[{type:"line",x:{data:b},y:{data:a},title:""}])},PIECHART:function(a,b,c){return jSE.chart.apply(this,[{type:"pie",data:a,legend:b,title:c}])},DOTCHART:function(g,d,a,c,b,f){return jSE.chart.apply(this,[{type:"dot",data:(a?a:g),x:{data:g,legend:c},y:{data:(d?d:g),legend:(b?b:c)},title:f}])},CELLREF:function(a){return(this.jS.spreadsheets[a]?this.jS.spreadsheets[a]:"Cell Reference Not Found")},CALCTIME:function(){var a=this;this.s.origParent.one("calculation",function(){jQuery(a.jS.getTd(a.sheet,a.row,a.col)).text(a.jS.time.diff())});return""}};var key={BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,ALT:18,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,F:70,V:86,Y:89,Z:90};var arrHelpers={foldPrepare:function(b,d,c){var a;if(b!=null&&b instanceof Object&&b.length!=null){a=b}else{a=d}if(c){a=this.unique(a)}return a},fold:function(b,g,a,d,f){for(var c=0;c<b.length;c++){a=g(a,(d==true?f(b[c]):b[c]))}return a},toNumbers:function(a){a=this.flatten(a);for(var b=0;b<a.length;b++){if(a[b]){a[b]=jQuery.trim(a[b]);if(isNaN(a[b])){a[b]=0}else{a[b]=a[b]*1}}else{a[b]=0}}return a},unique:function(b){var d=[];var c=b.length;for(var g=0;g<c;g++){for(var f=g+1;f<c;f++){if(b[g]===b[f]){f=++g}}d.push(b[g])}return d},flatten:function(a){var f=[];for(var c=0,b=a.length;c<b;c++){var d=Object.prototype.toString.call(a[c]).split(" ").pop().split("]").shift().toLowerCase();if(d){f=f.concat(/^(array|collection|arguments|object)$/.test(d)?this.flatten(a[c]):a[c])}}return f},insertAt:function(a,c,b){jQuery(c).each(function(){if(b>-1&&b<=a.length){a.splice(b,0,this)}});return a}};
